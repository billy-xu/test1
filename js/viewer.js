var X3=X3||{};(function(t){"use strict";t.extend({parseQuery:function(){for(var t,e={},n=/\+/g,i=/([^&=]+)=?([^&]*)/g,r=function(t){return decodeURIComponent(t.replace(n," "))},o=window.location.search.substring(1);t=i.exec(o);)e[r(t[1])]=r(t[2]);return e}})})(jQuery),function(){"use strict";return X3.Matrix4=function(t,e,n,i,r,o,a,s,u,l,c,h,f,d,p,m){this.set(t,e,n,i,r,o,a,s,u,l,c,h,f,d,p,m)},X3.Matrix4.prototype.elements=function(){},X3.Matrix4.prototype.setByArray=function(t){return this.n11=t[0],this.n12=t[1],this.n13=t[2],this.n14=t[3],this.n21=t[4],this.n22=t[5],this.n23=t[6],this.n24=t[7],this.n31=t[8],this.n32=t[9],this.n33=t[10],this.n34=t[11],this.n41=t[12],this.n42=t[13],this.n43=t[14],this.n44=t[15],this},X3.Matrix4.prototype.copy=function(t){return this.n11=t.n11,this.n12=t.n12,this.n13=t.n13,this.n14=t.n14,this.n21=t.n21,this.n22=t.n22,this.n23=t.n23,this.n24=t.n24,this.n31=t.n31,this.n32=t.n32,this.n33=t.n33,this.n34=t.n34,this.n41=t.n41,this.n42=t.n42,this.n43=t.n43,this.n44=t.n44,this},X3.Matrix4.prototype.set=function(t,e,n,i,r,o,a,s,u,l,c,h,f,d,p,m){return this.n11=t,this.n12=e,this.n13=n,this.n14=i,this.n21=r,this.n22=o,this.n23=a,this.n24=s,this.n31=u,this.n32=l,this.n33=c,this.n34=h,this.n41=f,this.n42=d,this.n43=p,this.n44=m,this},X3.Matrix4.prototype.getXAxis=function(){return new X3.Vector3(this.n11,this.n21,this.n31).normalize()},X3.Matrix4.prototype.setXAxis=function(t){return this.n11=t.x,this.n21=t.y,this.n31=t.z,this},X3.Matrix4.prototype.getYAxis=function(){return new X3.Vector3(this.n12,this.n22,this.n32).normalize()},X3.Matrix4.prototype.setYAxis=function(t){return this.n12=t.x,this.n22=t.y,this.n32=t.z,this},X3.Matrix4.prototype.getZAxis=function(){return new X3.Vector3(this.n13,this.n23,this.n33).normalize()},X3.Matrix4.prototype.setZAxis=function(t){return this.n13=t.x,this.n23=t.y,this.n33=t.z,this},X3.Matrix4.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},X3.Matrix4.prototype.clone=function(){var t;return t=new X3.Matrix4,t.n11=this.n11,t.n12=this.n12,t.n13=this.n13,t.n14=this.n14,t.n21=this.n21,t.n22=this.n22,t.n23=this.n23,t.n24=this.n24,t.n31=this.n31,t.n32=this.n32,t.n33=this.n33,t.n34=this.n34,t.n41=this.n41,t.n42=this.n42,t.n43=this.n43,t.n44=this.n44,t},X3.Matrix4.prototype.multiply=function(t){var e,n,i,r,o,a,s,u,l,c,h,f,d,p,m,g,v,y,E,x,w,b,_,T,C,I,A,L,N,S,P,D,k,R,M,V,O,X,B,W,z,H,$,F,U,G,j,Y;return e=this.n11,n=this.n12,i=this.n13,r=this.n14,o=this.n21,a=this.n22,s=this.n23,u=this.n24,l=this.n31,c=this.n32,h=this.n33,f=this.n34,d=this.n41,p=this.n42,m=this.n43,g=this.n44,v=t.n11,y=t.n12,E=t.n13,x=t.n14,w=t.n21,b=t.n22,_=t.n23,T=t.n24,C=t.n31,I=t.n32,A=t.n33,L=t.n34,N=t.n41,S=t.n42,P=t.n43,D=t.n44,k=e*v+n*w+i*C+r*N,R=e*y+n*b+i*I+r*S,M=e*E+n*_+i*A+r*P,V=e*x+n*T+i*L+r*D,O=o*v+a*w+s*C+u*N,X=o*y+a*b+s*I+u*S,B=o*E+a*_+s*A+u*P,W=o*x+a*T+s*L+u*D,z=l*v+c*w+h*C+f*N,H=l*y+c*b+h*I+f*S,$=l*E+c*_+h*A+f*P,F=l*x+c*T+h*L+f*D,U=d*v+p*w+m*C+g*N,G=d*y+p*b+m*I+g*S,j=d*E+p*_+m*A+g*P,Y=d*x+p*T+m*L+g*D,new X3.Matrix4(k,R,M,V,O,X,B,W,z,H,$,F,U,G,j,Y)},X3.Matrix4.prototype.multiplyScalar=function(t){var e,n,i,r,o,a,s,u,l,c,h,f,d,p,m,g;return e=this.n11*t,n=this.n12*t,i=this.n13*t,r=this.n14*t,o=this.n21*t,a=this.n22*t,s=this.n23*t,u=this.n24*t,l=this.n31*t,c=this.n32*t,h=this.n33*t,f=this.n34*t,d=this.n41*t,p=this.n42*t,m=this.n43*t,g=this.n44*t,new X3.Matrix4(e,n,i,r,o,a,s,u,l,c,h,f,d,p,m,g)},X3.Matrix4.prototype.transpose=function(){var t;return t=void 0,t=this.n21,this.n21=this.n12,this.n12=t,t=this.n31,this.n31=this.n13,this.n13=t,t=this.n32,this.n32=this.n23,this.n23=t,t=this.n41,this.n41=this.n14,this.n14=t,t=this.n42,this.n42=this.n24,this.n24=t,t=this.n43,this.n43=this.n34,this.n43=t,this},X3.Matrix4.prototype.setTranslation=function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},X3.Matrix4.prototype.setScale=function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},X3.Matrix4.prototype.setRotationX=function(t){var e,n;return e=Math.cos(t),n=Math.sin(t),this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},X3.Matrix4.prototype.setRotationY=function(t){var e,n;return e=Math.cos(t),n=Math.sin(t),this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},X3.Matrix4.prototype.setRotationZ=function(t){var e,n;return e=Math.cos(t),n=Math.sin(t),this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},X3.Matrix4.prototype.setRotationAxis=function(t,e){var n,i,r,o,a,s,u,l;return n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,u=t.y,l=t.z,o=r*s,a=r*u,this.set(o*s+n,o*u-i*l,o*l+i*u,0,o*u+i*l,a*u+n,a*l-i*s,0,o*l-i*u,a*l+i*s,r*l*l+n,0,0,0,0,1),this},X3.Matrix4.prototype.rotateAxis=function(t){var e,n,i;return e=t.x,n=t.y,i=t.z,t.x=e*this.n11+n*this.n21+i*this.n31,t.y=e*this.n12+n*this.n22+i*this.n32,t.z=e*this.n13+n*this.n23+i*this.n33,t=t.normalize()},X3.Matrix4.prototype.setPosition=function(t){return this.n14=t.x,this.n24=t.y,this.n34=t.z,this},X3.Matrix4.prototype.getPosition=function(){return this.position||(this.position=new X3.Vector3),this.position.set(this.n14,this.n24,this.n34),this.position},X3.Matrix4.prototype.setRotationFromQuaternion=function(t){var e,n,i,r,o,a,s,u,l,c,h,f,d,p,m,g;return o=t.x,c=t.y,p=t.z,e=t.w,a=o+o,h=c+c,m=p+p,s=o*a,u=o*h,l=o*m,f=c*h,d=c*m,g=p*m,n=e*a,i=e*h,r=e*m,this.n11=1-(f+g),this.n12=u-r,this.n13=l+i,this.n21=u+r,this.n22=1-(s+g),this.n23=d-n,this.n31=l-i,this.n32=d+n,this.n33=1-(s+f),this},X3.Matrix4.prototype.scale=function(t){var e,n,i,r,o,a,s,u,l,c,h,f,d,p,m;return d=t.x,p=t.y,m=t.z,e=this.n11*d,n=this.n12*p,i=this.n13*m,r=this.n21*d,o=this.n22*p,a=this.n23*m,s=this.n31*d,u=this.n32*p,l=this.n33*m,c=this.n41*d,h=this.n42*p,f=this.n43*m,new X3.Matrix4(e,n,i,this.n14,r,o,a,this.n24,s,u,l,this.n34,c,h,f,this.n44)},X3.Matrix4.prototype.extractPosition=function(t){return this.n14=t.n14,this.n24=t.n24,this.n34=t.n34},X3.Matrix4.prototype.extractRotation=function(t,e){var n,i,r;return n=1/e.x,i=1/e.y,r=1/e.z,this.n11=t.n11*n,this.n21=t.n21*n,this.n31=t.n31*n,this.n12=t.n12*i,this.n22=t.n22*i,this.n32=t.n32*i,this.n13=t.n13*r,this.n23=t.n23*r,this.n33=t.n33*r},X3.Matrix4.prototype.determinant=function(){var t,e,n,i,r,o,a,s,u,l,c,h,f,d,p,m;return t=this.n11,e=this.n12,n=this.n13,i=this.n14,r=this.n21,o=this.n22,a=this.n23,s=this.n24,u=this.n31,l=this.n32,c=this.n33,h=this.n34,f=this.n41,d=this.n42,p=this.n43,m=this.n44,i*a*l*f-n*s*l*f-i*o*c*f+e*s*c*f+n*o*h*f-e*a*h*f-i*a*u*d+n*s*u*d+i*r*c*d-t*s*c*d-n*r*h*d+t*a*h*d+i*o*u*p-e*s*u*p-i*r*l*p+t*s*l*p+e*r*h*p-t*o*h*p-n*o*u*m+e*a*u*m+n*r*l*m-t*a*l*m-e*r*c*m+t*o*c*m},X3.Matrix4.prototype.invert=function(){var t,e,n,i,r,o,a,s,u,l,c,h,f,d,p,m,g,v,y,E,x,w,b,_,T,C,I;return t=new X3.Matrix4,o=this.n11,a=this.n12,s=this.n13,u=this.n14,l=this.n21,c=this.n22,h=this.n23,f=this.n24,d=this.n31,p=this.n32,m=this.n33,g=this.n34,v=this.n41,y=this.n42,E=this.n43,x=this.n44,e=void 0,n=void 0,i=void 0,r=void 0,C=void 0,w=Array(8),b=Array(8),_=Array(8),T=Array(8),w[0]=o,w[1]=a,w[2]=s,w[3]=u,w[4]=1,w[5]=w[6]=w[7]=0,b[0]=l,b[1]=c,b[2]=h,b[3]=f,b[5]=1,b[4]=b[6]=b[7]=0,_[0]=d,_[1]=p,_[2]=m,_[3]=g,_[6]=1,_[4]=_[5]=_[7]=0,T[0]=v,T[1]=y,T[2]=E,T[3]=x,T[7]=1,T[4]=T[5]=T[6]=0,I=Array(8),Math.abs(T[0])>Math.abs(_[0])&&(I=T,T=_,_=I),Math.abs(_[0])>Math.abs(b[0])&&(I=_,_=b,b=I),Math.abs(b[0])>Math.abs(w[0])&&(I=b,b=w,w=I),0===w[0]?t:(n=b[0]/w[0],i=_[0]/w[0],r=T[0]/w[0],C=w[1],b[1]-=n*C,_[1]-=i*C,T[1]-=r*C,C=w[2],b[2]-=n*C,_[2]-=i*C,T[2]-=r*C,C=w[3],b[3]-=n*C,_[3]-=i*C,T[3]-=r*C,C=w[4],0!==C&&(b[4]-=n*C,_[4]-=i*C,T[4]-=r*C),C=w[5],0!==C&&(b[5]-=n*C,_[5]-=i*C,T[5]-=r*C),C=w[6],0!==C&&(b[6]-=n*C,_[6]-=i*C,T[6]-=r*C),C=w[7],0!==C&&(b[7]-=n*C,_[7]-=i*C,T[7]-=r*C),Math.abs(T[1])>Math.abs(_[1])&&(I=T,T=_,_=I),Math.abs(_[1])>Math.abs(b[1])&&(I=_,_=b,b=I),0===b[1]?t:(i=_[1]/b[1],r=T[1]/b[1],_[2]-=i*b[2],T[2]-=r*b[2],_[3]-=i*b[3],T[3]-=r*b[3],C=b[4],0!==C&&(_[4]-=i*C,T[4]-=r*C),C=b[5],0!==C&&(_[5]-=i*C,T[5]-=r*C),C=b[6],0!==C&&(_[6]-=i*C,T[6]-=r*C),C=b[7],0!==C&&(_[7]-=i*C,T[7]-=r*C),Math.abs(T[2])>Math.abs(_[2])&&(I=T,T=_,_=I),0===_[2]?t:(r=T[2]/_[2],T[3]-=r*_[3],T[4]-=r*_[4],T[5]-=r*_[5],T[6]-=r*_[6],T[7]-=r*_[7],0===T[3]?0:(C=1/T[3],T[4]*=C,T[5]*=C,T[6]*=C,T[7]*=C,i=_[3],C=1/_[2],_[4]=C*(_[4]-T[4]*i),_[5]=C*(_[5]-T[5]*i),_[6]=C*(_[6]-T[6]*i),_[7]=C*(_[7]-T[7]*i),n=b[3],b[4]-=T[4]*n,b[5]-=T[5]*n,b[6]-=T[6]*n,b[7]-=T[7]*n,e=w[3],w[4]-=T[4]*e,w[5]-=T[5]*e,w[6]-=T[6]*e,w[7]-=T[7]*e,n=b[2],C=1/b[1],b[4]=C*(b[4]-_[4]*n),b[5]=C*(b[5]-_[5]*n),b[6]=C*(b[6]-_[6]*n),b[7]=C*(b[7]-_[7]*n),e=w[2],w[4]-=_[4]*e,w[5]-=_[5]*e,w[6]-=_[6]*e,w[7]-=_[7]*e,e=w[1],C=1/w[0],w[4]=C*(w[4]-b[4]*e),w[5]=C*(w[5]-b[5]*e),w[6]=C*(w[6]-b[6]*e),w[7]=C*(w[7]-b[7]*e),t.n11=w[4],t.n12=w[5],t.n13=w[6],t.n14=w[7],t.n21=b[4],t.n22=b[5],t.n23=b[6],t.n24=b[7],t.n31=_[4],t.n32=_[5],t.n33=_[6],t.n34=_[7],t.n41=T[4],t.n42=T[5],t.n43=T[6],t.n44=T[7],t))))},X3.Matrix4.createFromVector4=function(t){var e,n,i,r;return e=(new X3.Matrix4).identity(),n=2*t.x*t.x,i=2*t.y*t.y,r=2*t.z*t.z,e.n11=1-i-r,e.n22=1-r-n,e.n33=1-i-n,n=2*t.x*t.y,i=2*t.z*t.w,e.n12=n-i,e.n21=n+i,n=2*t.z*t.x,i=2*t.y*t.w,e.n13=n+i,e.n31=n-i,n=2*t.y*t.z,i=2*t.x*t.w,e.n23=n-i,e.n32=n+i,e},X3.Matrix4.createPerspectiveMatrix=function(t,e,n,i,r,o){var a,s,u,l;return u=(new X3.Matrix4).identity(),l=e-t,a=i-n,s=o-r,u.n11=2*r/l,u.n12=0,u.n13=0,u.n14=0,u.n21=0,u.n22=2*r/a,u.n23=0,u.n24=0,u.n31=(e+t)/l,u.n32=(i+n)/a,u.n33=-(o+r)/s,u.n34=-1,u.n41=0,u.n42=0,u.n43=-2*o*r/s,u.n44=0,u},X3.Matrix4.createOrthographicMatrix=function(t,e,n,i,r,o){var a,s,u,l;return u=(new X3.Matrix4).identity(),l=e-t,a=i-n,s=o-r,u.n11=2/l,u.n12=0,u.n13=0,u.n14=0,u.n21=0,u.n22=2/a,u.n23=0,u.n24=0,u.n31=0,u.n32=0,u.n33=-2/s,u.n34=0,u.n41=-(e+t)/l,u.n42=-(i+n)/a,u.n43=-(o+r)/s,u.n44=1,u},X3.Matrix4}.call(this),function(){"use strict";return X3.Quaternion=function(){this.mX=0,this.mY=0,this.mZ=0,this.mW=1},X3.Quaternion.prototype.set=function(t,e,n,i){return this.mX=t,this.mY=e,this.mZ=n,this.mW=i,this},X3.Quaternion.prototype.setFromVector3=function(t){return this.mX=t.x,this.mY=t.y,this.mZ=t.z,this},X3.Quaternion.prototype.setFromQuaternion=function(t){return this.mX=t.mX,this.mY=t.mY,this.mZ=t.mZ,this.mW=t.mW},X3.Quaternion.prototype.setX=function(t){return this.mX=t,this},X3.Quaternion.prototype.setY=function(t){return this.mY=t,this},X3.Quaternion.prototype.setZ=function(t){return this.mZ=t,this},X3.Quaternion.prototype.setW=function(t){return this.mW=t,this},X3.Quaternion.prototype.getX=function(){return this.mX},X3.Quaternion.prototype.getY=function(){return this.mY},X3.Quaternion.prototype.getZ=function(){return this.mZ},X3.Quaternion.prototype.getW=function(){return this.mW},X3.Quaternion.prototype.identity=function(){return this.set(0,0,0,1),this},X3.Quaternion.prototype.product=function(t){return this.set(this.mW*t.mW-this.mX*t.mX-this.mY*t.mY-this.mZ*t.mZ,this.mW*t.mX+this.mX*t.mW+this.mZ*t.mY-this.mY*t.mZ,this.mW*t.mY+this.mY*t.mW+this.mX*t.mZ-this.mZ*t.mX,this.mW*t.mZ+this.mZ*t.mW+this.mY*t.mX-this.mX*t.mY)},X3.Quaternion.prototype.productEquals=function(t){return this.setToQuaternion(this.product(t)),this},X3.Quaternion.prototype.notEquals=function(t){return!(this.mX===t.mX&&this.mY===t.mY&&this.mZ===t.mZ&&this.mW===t.mW)},X3.Quaternion.prototype.setToRotateX=function(t){var e;return e=.5*t,this.set(Math.sin(e),0,0,Math.cos(e))},X3.Quaternion.prototype.normalize=function(){var t,e;return t=Math.sqrt(this.mW*this.mW+this.mX*this.mX+this.mY*this.mY+this.mZ*this.mZ),t>0?(e=1/t,this.set(this.mX*e,this.mY*e,this.mZ*e,this.mW*e)):this.identity()},X3.Quaternion.prototype.setToRotateY=function(t){var e;return e=.5*t,this.set(0,Math.sin(e),0,Math.cos(e))},X3.Quaternion.prototype.setToRotateZ=function(t){var e;return e=.5*t,this.set(0,0,Math.sin(e),Math.cos(e))},X3.Quaternion.prototype.setToRotateAxis=function(t,e){var n,i;return i=.5*e,n=Math.sin(i),this.set(t.x*n,t.y*n,t.z*n,Math.cos(i))},X3.Quaternion.prototype.setToQuaternion=function(t){return this.set(t.mX,t.mY,t.mZ,t.mW)},X3.Quaternion.prototype.getRotationAngle=function(){var t;return t=Math.acos(this.mW),2*t},X3.Quaternion.prototype.getRotationAxis=function(){var t,e;return e=1-this.mW*this.mW,0>=e?new X3.Vector3(1,0,0):(t=1/Math.sqrt(e),new X3.Vector3(this.mX*t,this.mY*t,this.mZ*t))},X3.Quaternion}.call(this),function(){"use strict";X3.Vector2=function(t,e){this.x=t||0,this.y=e||0},X3.Vector2.prototype.set=function(t,e){return this.x=t,this.y=e,this},X3.Vector2.prototype.clone=function(){return new X3.Vector2(this.x,this.y)},X3.Vector2.prototype.add=function(t){var e,n;return e=this.x+t.x,n=this.y+t.y,new X3.Vector2(e,n)},X3.Vector2.prototype.sub=function(t){var e,n;return e=this.x-t.x,n=this.y-t.y,new X3.Vector2(e,n)},X3.Vector2.prototype.multiply=function(t){var e,n;return e=this.x*t.x,n=this.y*t.y,new X3.Vector2(e,n)},X3.Vector2.prototype.multiplyScalar=function(t){var e,n;return e=this.x*t,n=this.y*t,new X3.Vector2(e,n)},X3.Vector2.prototype.divide=function(t){var e,n;return e=this.x/t.x,n=this.y/t.y,new X3.Vector2(e,n)},X3.Vector2.prototype.normalize=function(){return this.divideScalar(this.length())},X3.Vector2.prototype.lengthSq=function(){var t;return t=this.x*this.x+this.y*this.y},X3.Vector2.prototype.length=function(){var t;return t=this.lengthSq(),t=Math.sqrt(t)},X3.Vector2.prototype.divideScalar=function(t){var e,n;return e=0,n=0,t&&(e=this.x/t,n=this.y/t),new X3.Vector2(e,n)},X3.Vector2.prototype.dot=function(t){return this.x*t.x+this.y*t.y},X3.Vector2.prototype.toVector3=function(t){return new X3.Vector3(this.x,this.y,t)}}.call(this),function(){"use strict";X3.Vector3=function(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0},X3.Vector3.prototype.set=function(t,e,n){return this.x=t,this.y=e,this.z=n,this},X3.Vector3.prototype.clone=function(){return new X3.Vector3(this.x,this.y,this.z)},X3.Vector3.prototype.add=function(t){var e,n,i;return e=this.x+t.x,n=this.y+t.y,i=this.z+t.z,new X3.Vector3(e,n,i)},X3.Vector3.add=function(t,e){var n,i,r;return n=t.x+e.x,i=t.y+e.y,r=t.z+e.z,new X3.Vector3(n,i,r)},X3.Vector3.prototype.addScalar=function(t){var e,n,i;return e=this.x+t,n=this.y+t,i=this.z+t,new X3.Vector3(e,n,i)},X3.Vector3.addScalar=function(t,e){var n,i,r;return n=t.x+e,i=t.y+e,r=t.z+e,new X3.Vector3(n,i,r)},X3.Vector3.prototype.sub=function(t){var e,n,i;return e=this.x-t.x,n=this.y-t.y,i=this.z-t.z,new X3.Vector3(e,n,i)},X3.Vector3.sub=function(t,e){var n,i,r;return n=t.x-e.x,i=t.y-e.y,r=t.z-e.z,new X3.Vector3(n,i,r)},X3.Vector3.prototype.multiply=function(t){var e,n,i;return e=this.x*t.x,n=this.y*t.y,i=this.z*t.z,new X3.Vector3(e,n,i)},X3.Vector3.prototype.multiplyScalar=function(t){var e,n,i;return e=this.x*t,n=this.y*t,i=this.z*t,new X3.Vector3(e,n,i)},X3.Vector3.prototype.divideScalar=function(t){var e,n,i;return e=0,n=0,i=0,t&&(e=this.x/t,n=this.y/t,i=this.z/t),new X3.Vector3(e,n,i)},X3.Vector3.prototype.negate=function(){return this.multiplyScalar(-1)},X3.Vector3.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},X3.Vector3.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},X3.Vector3.prototype.lengthSq=function(){var t;return t=this.x*this.x+this.y*this.y+this.z*this.z},X3.Vector3.prototype.length=function(){var t;return t=this.lengthSq(),t=Math.sqrt(t)},X3.Vector3.prototype.normalize=function(){return this.divideScalar(this.length())},X3.Vector3.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},X3.Vector3.prototype.cross=function(t){var e,n,i;return e=this.y*t.z-this.z*t.y,n=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x,new X3.Vector3(e,n,i)},X3.Vector3.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},X3.Vector3.prototype.distanceToSquared=function(t){return(new X3.Vector3).sub(t).lengthSq()},X3.Vector3.prototype.perpendicular=function(){return Math.abs(this.x)>1e-7?new X3.Vector3(this.y,-this.x,0):Math.abs(this.y)>1e-7?new X3.Vector3(-this.y,this.x,0):new X3.Vector3(-this.z,0,this.x)},X3.Vector3.prototype.toVector4=function(t){return new X3.Vector4(this.x,this.y,this.z,t)}}.call(this),function(){"use strict";X3.Vector4=function(t,e,n,i){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==i?i:1},X3.Vector4.prototype.set=function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},X3.Vector4.prototype.clone=function(){return new X3.Vector4(this.x,this.y,this.z,this.w)},X3.Vector4.prototype.add=function(t){var e,n,i,r;return n=this.x+t.x,i=this.y+t.y,r=this.z+t.z,e=this.w+t.w,new X3.Vector4(n,i,r,e)},X3.Vector4.prototype.sub=function(t){var e,n,i,r;return n=this.x-t.x,i=this.y-t.y,r=this.z-t.z,e=this.w-t.w,new X3.Vector4(n,i,r,e)},X3.Vector4.prototype.multiplyScalar=function(t){var e,n,i,r;return n=this.x*t,i=this.y*t,r=this.z*t,e=this.w*t,new X3.Vector4(n,i,r,e)},X3.Vector4.prototype.divideScalar=function(t){var e,n,i,r;return n=0,i=0,r=0,e=0,t&&(n=this.x/t,i=this.y/t,r=this.z/t,e=this.w/t),new X3.Vector4(n,i,r,e)},X3.Vector4.prototype.multiplyMatrix4=function(t){var e,n,i,r;return n=this.x*t.n11+this.y*t.n21+this.z*t.n31+this.w*t.n41,i=this.x*t.n12+this.y*t.n22+this.z*t.n32+this.w*t.n42,r=this.x*t.n13+this.y*t.n23+this.z*t.n33+this.w*t.n43,e=this.x*t.n14+this.y*t.n24+this.z*t.n34+this.w*t.n44,new X3.Vector4(n,i,r,e)},X3.Vector4.prototype.negate=function(){return this.multiplyScalar(-1)},X3.Vector4.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},X3.Vector4.prototype.lengthSq=function(){return this.dot(this)},X3.Vector4.prototype.length=function(){return Math.sqrt(this.lengthSq())},X3.Vector4.prototype.normalize=function(){return this.divideScalar(this.length())},X3.Vector4.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},X3.Vector4.prototype.lerpSelf=function(t,e){var n,i,r,o;return i=this.x+(t.x-this.x)*e,r=this.y+(t.y-this.y)*e,o=this.z+(t.z-this.z)*e,n=this.w+(t.w-this.w)*e,new X3.Vector4(i,r,o,n)},X3.Vector4.prototype.toVector3=function(){return new X3.Vector3(this.x,this.y,this.z)}}.call(this),function(){"use strict";return X3.Box3=function(){this.min=new X3.Vector3(1,1,1),this.max=new X3.Vector3(-1,-1,-1),this.clone=function(){var t;return t=new X3.Box3,t.min=this.min.clone(),t.max=this.max.clone(),t}},X3.Box3.prototype.isEmpty=function(){return this.max.x<this.min.x?!0:this.max.y<this.min.y?!0:this.max.z<this.min.z?!0:!1},X3.Box3.prototype.center=function(){var t;return t=this.min.add(this.max),t=t.multiplyScalar(.5)},X3.Box3.prototype.size=function(){return this.max.sub(this.min)},X3.Box3.prototype.scale=function(t,e,n){if(!this.isEmpty()){var i=this.center(),r=this.size();t=Math.abs(t);var o=i.x+r.x*t/2,a=i.x-r.x*t/2;e=void 0==e?t:Math.abs(e);var s=i.y+r.y*e/2,u=i.y-r.y*e/2;n=void 0==n?t:Math.abs(n);var l=i.z+r.z*n/2,c=i.z-r.z*n/2;this.max=new X3.Vector3(o,s,l),this.min=new X3.Vector3(a,u,c)}},X3.Box3.prototype.resize=function(t,e,n){if(!this.isEmpty()){var i=this.center();t=Math.abs(t);var r=i.x+t/2,o=i.x-t/2;e=void 0==e?t:Math.abs(e);var a=i.y+e/2,s=i.y-e/2;n=void 0==n?t:Math.abs(n);var u=i.z+n/2,l=i.z-n/2;this.max=new X3.Vector3(r,a,u),this.min=new X3.Vector3(o,s,l)}},X3.Box3.prototype.add=function(t){if(this.isEmpty())return this.min=t,this.max=t,void 0;if(!(-1e37>t.x||t.x>1e37||-1e37>t.y||t.y>1e37||-1e37>t.z||t.z>1e37))return t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.mix.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z?this.max.z=t.z:void 0},X3.Box3.prototype.transform=function(t){var e,n;return n=this.min.clone(),e=this.max.clone(),this.min.x=t.n41,this.min.y=t.n42,this.min.z=t.n43,this.max=this.min.clone(),t.n11>0?(this.min.x=this.min.x+t.n11*n.x,this.max.x=this.max.x+t.n11*e.x):(this.min.x=this.min.x+t.n11*e.x,this.max.x=this.max.x+t.n11*n.x),t.n12>0?(this.min.y=this.min.y+t.n12*n.x,this.max.y=this.max.y+t.n12*e.x):(this.min.y=this.min.y+t.n12*e.x,this.max.y=this.max.y+t.n12*n.x),t.n13>0?(this.min.z=this.min.z+t.n13*n.x,this.max.z=this.max.z+t.n13*e.x):(this.min.z=this.min.z+t.n13*e.x,this.max.z=this.max.z+t.n13*n.x),t.n21>0?(this.min.x=this.min.x+t.n21*n.y,this.max.x=this.max.x+t.n21*e.y):(this.min.x=this.min.x+t.n21*e.y,this.max.x=this.max.x+t.n21*n.y),t.n22>0?(this.min.y=this.min.y+t.n22*n.y,this.max.y=this.max.y+t.n22*e.y):(this.min.y=this.min.y+t.n22*e.y,this.max.y=this.max.y+t.n22*n.y),t.n23>0?(this.min.z=this.min.z+t.n23*n.y,this.max.z=this.max.z+t.n23*e.y):(this.min.z=this.min.z+t.n23*e.y,this.max.z=this.max.z+t.n23*n.y),t.n31>0?(this.min.x=this.min.x+t.n31*n.z,this.max.x=this.max.x+t.n31*e.z):(this.min.x=this.min.x+t.n31*e.z,this.max.x=this.max.x+t.n31*n.z),t.n32>0?(this.min.y=this.min.y+t.n32*n.z,this.max.y=this.max.y+t.n32*e.z):(this.min.y=this.min.y+t.n32*e.z,this.max.y=this.max.y+t.n32*n.z),t.n33>0?(this.min.z=this.min.z+t.n33*n.z,this.max.z=this.max.z+t.n33*e.z):(this.min.z=this.min.z+t.n33*e.z,this.max.z=this.max.z+t.n33*n.z)},X3.Box3.prototype.intersectLine=function(t,e,n){return e.x<this.min.x&&t.x<this.min.x?!1:e.x>this.max.x&&t.x>this.max.x?!1:e.y<this.min.y&&t.y<this.min.y?!1:e.y>this.max.y&&t.y>this.max.y?!1:e.z<this.min.z&&t.z<this.min.z?!1:e.z>this.max.z&&t.z>this.max.z?!1:t.x>this.min.x&&t.x<this.max.x&&t.y>this.min.y&&t.y<this.max.y&&t.z>this.min.z&&t.z<this.max.z?(n.x=t.x,n.y=t.y,n.z=t.z,!1):this.getIntersection(t.x-this.min.x,e.x-this.min.x,t,e,n)&&this.inBox(n,1)||this.getIntersection(t.y-this.min.y,e.y-this.min.y,t,e,n)&&this.inBox(n,2)||this.getIntersection(t.z-this.min.z,e.z-this.min.z,t,e,n)&&this.inBox(n,3)||this.getIntersection(t.x-this.max.x,e.x-this.max.x,t,e,n)&&this.inBox(n,1)||this.getIntersection(t.y-this.max.y,e.y-this.max.y,t,e,n)&&this.inBox(n,2)||this.getIntersection(t.z-this.max.z,e.z-this.max.z,t,e,n)&&this.inBox(n,3)?!0:!1},X3.Box3.prototype.getIntersection=function(t,e,n,i,r){var o=1e-7;if(t*e>=o)return!1;if(o>Math.abs(t-e))return!1;var a;return a=o>Math.abs(t)?n:o>Math.abs(e)?i:n.add(i.sub(n).multiplyScalar(-t/(e-t))),r.x=a.x,r.y=a.y,r.z=a.z,!0},X3.Box3.prototype.inBox=function(t,e){return 1===e&&t.z>this.min.z&&t.z<this.max.z&&t.y>this.min.y&&t.y<this.max.y?!0:2===e&&t.z>this.min.z&&t.z<this.max.z&&t.x>this.min.x&&t.x<this.max.x?!0:3===e&&t.x>this.min.x&&t.x<this.max.x&&t.y>this.min.y&&t.y<this.max.y?!0:!1},X3.Box3.prototype.contains=function(t){return this.inBox(t,1)&&this.inBox(t,2)&&this.inBox(t,3)},X3.Box3}.call(this),function(){"use strict";X3.Camera=function(){var t={eye:new X3.Vector3(0,0,0),center:new X3.Vector3(0,0,-1),up:new X3.Vector3(0,1,0),frustum:new X3.Frustum(-1,1,-1,1,2.4,1e3),modelView:(new X3.Matrix4).identity(),modelViewProjection:(new X3.Matrix4).identity(),windowWidth:0,windowHeight:0,sceneBox:null,sceneFront:null,minCameraStep:.001,limitPlane:null,limitAxis:null,limitAngle:null,init:function(e){t.sceneBox=e.box,t.sceneFront=e.front},activateLimitPlane:function(){t.limitPlane=new X3.Plane;var e=t.sceneBox,n=t.sceneFront,i=new X3.Vector3(n[6],n[7],n[8]),r=e.center(),o=e.size(),a=r.dot(i)-o.dot(i)/2;t.limitPlane.setDirect(i,-a)},activateLimitAngle:function(e,n){t.limitAxis=e,t.limitAngle=n},computeModelViewProjection:function(){t.modelViewProjection=t.modelView.multiply(t.frustum.getProjectionMatrix())},eye2Center:function(){var e=X3.Vector3.sub(t.eye,t.center);return e=X3.Vector3.dot(e,t.modelView.getZAxis())},adjustFrustum:function(){var e=t.eye.dot(t.modelView.getZAxis().negate()),n=t.sceneBox.center().dot(t.modelView.getZAxis().negate()),i=t.sceneBox.size().length(),r=n-i/2-e;r=Math.max(r,t.minCameraStep);var o=n+i/2-e;o=Math.max(o,2*r);var a=t.frustum.getFovx(),s=t.frustum.getFovy();t.frustum.set(-r*a,r*a,-r*s,r*s,r,o),t.computeModelViewProjection()},resize:function(e,n){t.windowWidth=e,t.windowHeight=n;var i=e/n,r=t.frustum.getFovx(),o=t.frustum.getFovy(),a=Math.min(r,o),s=t.frustum.getLeft(),u=t.frustum.getTop();i>1?(o=a,r=o*i,s=-t.frustum.getNear()*r,u=t.frustum.getNear()*o):(r=a,o=r/i,s=-t.frustum.getNear()*r,u=t.frustum.getNear()*o),t.frustum.set(s,-s,-u,u),t.computeModelViewProjection()},lookAt:function(e,n,i){null!==t.limitPlane&&0>t.limitPlane.distance(e)||(null!=t.limitAxis&&null!=t.limitAngle?i.dot(t.limitAxis)>t.limitAngle&&t.lookAtInternal(e,n,i):t.lookAtInternal(e,n,i))},lookAtInternal:function(e,n,i){var r=e.sub(n).normalize(),o=i.cross(r).normalize(),a=r.cross(o).normalize();t.eye=e,t.center=n,t.up=a,t.modelView.n11=o.x,t.modelView.n21=o.y,t.modelView.n31=o.z,t.modelView.n12=a.x,t.modelView.n22=a.y,t.modelView.n32=a.z,t.modelView.n13=r.x,t.modelView.n23=r.y,t.modelView.n33=r.z,t.modelView.n41=-e.dot(o),t.modelView.n42=-e.dot(a),t.modelView.n43=-e.dot(r),t.adjustFrustum()},getEyeFromModelView:function(){var e=t.modelView,n=new X3.Vector3(e.n11,e.n21,e.n31),i=new X3.Vector3(e.n12,e.n22,e.n32),r=new X3.Vector3(e.n13,e.n23,e.n33),o=n.multiplyScalar(e.n41).add(i.multiplyScalar(e.n42)).add(r.multiplyScalar(e.n43)).negate();return o},setViewport:function(e,n,i,r,o,a,s){t.windowWidth=e,t.windowHeight=n,t.lookAt(i,r,o);var u=e/n;t.frustum.left(-u*a*t.frustum.near()),t.frustum.right(-t.frustum.left()),t.frustum.top(a*t.frustum.near()),t.frustum.bottom(-t.frustum.top()),t.frustum.setPerspective(s)},modelToWindow:function(e){var n=t.project(e);return t.fromNdcPoint(new X3.Vector2(n.x,n.y))},modelToAxis:function(e){var n=t.modelView,i=e.toVector4(0);i=i.multiplyMatrix4(n);var r=new X3.Vector3(i.x,i.y,i.z);r=r.normalize();var o=r.x,a=r.y,s=new X3.Vector2(o,-a);return s},windowToModel:function(e){var n=t.toNdcPoint(e);return e=n.toVector3(0),t.unproject(e)},project:function(e){var n=e.toVector4(1);return n=n.multiplyMatrix4(t.modelViewProjection),0>n.w&&(n.w=-n.w),n=n.divideScalar(n.w)},unproject:function(e){var n=e.toVector4(1);n=n.multiplyMatrix4(t.modelViewProjection.invert()),n=n.divideScalar(n.w);var i=n.toVector3();return i},toNdcPoint:function(e){var n=new X3.Vector2(t.windowWidth,t.windowHeight),i=new X3.Vector2(e.x,n.y-e.y);return i=i.divide(n),i=i.multiplyScalar(2).sub(new X3.Vector2(1,1))},fromNdcPoint:function(e){var n=new X3.Vector2(t.windowWidth,t.windowHeight),i=e.add(new X3.Vector2(1,1)).divideScalar(2);return i=i.multiply(n),i.y=n.y-i.y,i},quaternion:function(t,e){var n=t.length()*e.length(),i=t.dot(e)/n,r=t.cross(e).divideScalar(n);if(0===r.length()){if(!(0>i))return new X3.Quaternion;r=t.perpendicular().normalize()}var o=Math.sqrt((1-i)/2),a=Math.sqrt((1+i)/2);return(new X3.Quaternion).set(r.x*o,r.y*o,r.z*o,a)},sign:function(t){return 0===t?0:0>t?-1:1},zoomByFactor:function(e){if(t.frustum.isPerspective()){var n=t.modelView.getZAxis(),i=t.eye2Center(),r=i/e;if(Math.abs(i-r)<t.minCameraStep){var o=t.sign(e-1),a=n.multiplyScalar(-o*t.minCameraStep);t.lookAt(t.eye.add(a),t.center.add(a),t.up)}else t.lookAt(t.center.add(n.multiplyScalar(r)),t.center,t.up)}else{var s=t.frustum.getLeft()/e,u=t.frustum.getRight()/e,l=t.frustum.getBottom()/e,c=t.frustum.getTop()/e;t.frustum.set(s,u,l,c),t.computeModelViewProjection()}},zoomByBoundingBox:function(e){if(!e.isEmpty()){var n=(new X3.Matrix4).identity();n.setXAxis(t.modelView.getXAxis()),n.setYAxis(t.modelView.getYAxis()),n.setZAxis(t.modelView.getZAxis());var i=e.clone();t.minCameraStep=i.size().length()/1e3,i.transform(n);var r=t.frustum.getFovx()*t.minCameraStep,o=t.frustum.getFovy()*t.minCameraStep;t.frustum.set(-r,r,-o,o,t.minCameraStep,1e3*t.minCameraStep);var a,s,u;if(t.frustum.isPerspective()){var l=(t.frustum.getRight()-t.frustum.getLeft())/t.frustum.getNear(),c=(t.frustum.getTop()-t.frustum.getBottom())/t.frustum.getNear(),h=i.size().z/2+Math.max(i.size().x/l,i.size().y/c);a=e.center(),s=a.add(t.modelView.getZAxis().multiplyScalar(h)),u=t.modelView.getYAxis(),t.lookAt(s,a,u)}else{a=e.center(),s=a.add(t.modelView.getZAxis().multiplyScalar(i.size().length())),u=t.modelView.getYAxis(),t.lookAt(s,a,u);var f=t.frustum.getRight()-t.frustum.getLeft(),d=t.frustum.getTop()-t.frustum.getBottom(),p=1.1*Math.max(i.size().x/f,i.size().y/d);t.zoomByFactor(1/p)}}},zoomByWindow:function(e,n){var i=Math.abs(e.x-n.x),r=Math.abs(e.y-n.y),o=t.toNdcPoint(e),a=t.toNdcPoint(n),s=t.unproject(o.toVector3(0)),u=t.unproject(a.toVector3(0)),l=s.add(u).divideScalar(2),c=t.modelView.getZAxis().multiplyScalar(-1),h=t.modelView.getYAxis(),f=t.eye,d=l.sub(c.multiplyScalar(l.sub(f).dot(c))),p=d.add(c.multiplyScalar(t.eye2Center()));t.lookAt(d,p,h);var m=t.windowWidth/t.windowHeight,g=i/r,v=m>g?t.windowHeight/r:t.windowWidth/i;t.zoomByFactor(v)},getFrontAxises:function(){var e=t.sceneFront,n=new X3.Vector3(e[0],e[1],e[2]),i=new X3.Vector3(e[3],e[4],e[5]),r=new X3.Vector3(e[6],e[7],e[8]),o=n.sub(i).normalize(),a=r.normalize(),s=o.cross(a).normalize();return{x:s,y:o,z:a,up:a}},viewAngle:function(e){var n=t.sceneFront,i=new X3.Vector3(n[0],n[1],n[2]),r=new X3.Vector3(n[3],n[4],n[5]),o=new X3.Vector3(n[6],n[7],n[8]);t.lookAt(i,r,o);var a=r.add(t.modelView.getXAxis().negate()).add(t.modelView.getYAxis()).add(t.modelView.getZAxis());t.lookAt(a,r,o),t.zoomByBoundingBox(e)},viewFront:function(e){var n=t.sceneFront,i=new X3.Vector3(n[0],n[1],n[2]),r=new X3.Vector3(n[3],n[4],n[5]),o=new X3.Vector3(n[6],n[7],n[8]);t.lookAt(i,r,o),t.zoomByBoundingBox(e)},viewBack:function(e){t.viewFront(e),t.modelView.setZAxis(t.modelView.getZAxis().negate()),t.zoomByBoundingBox(e)},viewLeft:function(e){t.viewFront(e);var n=t.modelView.getXAxis().clone();t.modelView.setXAxis(t.modelView.getZAxis()),t.modelView.setZAxis(n.negate()),t.zoomByBoundingBox(e)},viewRight:function(e){t.viewFront(e);var n=t.modelView.getXAxis().clone();t.modelView.setXAxis(t.modelView.getZAxis().negate()),t.modelView.setZAxis(n),t.zoomByBoundingBox(e)},viewTop:function(e){t.viewFront(e);var n=t.modelView.getYAxis().clone();t.modelView.setYAxis(t.modelView.getZAxis().negate()),t.modelView.setZAxis(n),t.zoomByBoundingBox(e)},viewBottom:function(e){t.viewFront(e);var n=t.modelView.getYAxis().clone();t.modelView.setYAxis(t.modelView.getZAxis()),t.modelView.setZAxis(n.negate()),t.zoomByBoundingBox(e)},setPerspective:function(e){if(e!==t.frustum.isPerspective()){var n,i,r=t.center.sub(t.sceneBox.center());if(e){var o=t.frustum.getLeft();t.zoomByBoundingBox(t.sceneBox),i=t.frustum.getLeft()/o,t.frustum.setPerspective(!0),t.zoomByBoundingBox(t.sceneBox),n=Math.max(t.eye2Center()/i,t.minCameraStep);var a=t.center.add(r),s=a.add(t.modelView.getZAxis().multiplyScalar(n));t.lookAt(s,a,t.up)}else{n=t.eye2Center(),t.zoomByBoundingBox(t.sceneBox);var u=t.eye.sub(t.center).length();i=u/n,t.frustum.setPerspective(!1),t.zoomByBoundingBox(t.sceneBox),t.zoomByFactor(i),t.lookAt(t.eye.add(r),t.center.add(r),t.up)}}},getEyePosition:function(){return t.eye},setEyePosition:function(e){var n=e,i=t.center.add(e).sub(t.eye);t.lookAt(n,i,t.up)},getStatus:function(){var e=[t.eye.x,t.eye.y,t.eye.z,t.center.x,t.center.y,t.center.z,t.up.x,t.up.y,t.up.z,t.frustum.getFovy(),t.frustum.isPerspective()?0:1];return e}},e={activateLimitAngle:t.activateLimitAngle,activateLimitPlane:t.activateLimitPlane,override:function(n,i){t[n]=i,e[n]=i},extend:function(t,n){e[t]=n},getModelViewMatrix:function(){return t.modelView},getFrustum:function(){return t.frustum},getWindowWidth:function(){return t.windowWidth},getWindowHeight:function(){return t.windowHeight},getEye:function(){return t.eye},getCenter:function(){return t.center},getUp:function(){return t.up},getMinCameraStep:function(){return t.minCameraStep},getSceneBox:function(){return t.sceneBox},getSceneFront:function(){return t.sceneFront},getStatus:t.getStatus,sign:t.sign,init:t.init,resize:t.resize,lookAt:t.lookAt,zoomByFactor:t.zoomByFactor,zoomByBoundingBox:t.zoomByBoundingBox,zoomByWindow:t.zoomByWindow,getFrontAxises:t.getFrontAxises,viewAngle:t.viewAngle,viewFront:t.viewFront,viewBack:t.viewBack,viewTop:t.viewTop,viewBottom:t.viewBottom,viewLeft:t.viewLeft,viewRight:t.viewRight,setPerspective:t.setPerspective,getEyePosition:t.getEyePosition,setEyePosition:t.setEyePosition,modelToWindow:t.modelToWindow,windowToModel:t.windowToModel,modelToAxis:t.modelToAxis,project:t.project,unproject:t.unproject,toNdcPoint:t.toNdcPoint,fromNdcPoint:t.fromNdcPoint,modelViewProjection:t.modelViewProjection,eye2Center:t.eye2Center};return e}}.call(this),function(){"use strict";var t=X3.Camera;X3.Camera=function(){var e=new t,n={rotateSpeed:4,sectionPlane:null,sectionDistance:function(t){n.sectionPlane.distanceOrigin=t
},sectionNormal:function(t){n.sectionPlane.normal=t},sliceBoundingBox:function(t){if(null==n.sectionPlane||!n.sectionPlane.isValid())return t;var e=t.center(),i=t.size().divideScalar(2),r=Array(8);r[0]=e.add(new X3.Vector3(-i.x,-i.y,-i.z)),r[1]=e.add(new X3.Vector3(i.x,-i.y,-i.z)),r[2]=e.add(new X3.Vector3(-i.x,i.y,-i.z)),r[3]=e.add(new X3.Vector3(i.x,i.y,-i.z)),r[4]=e.add(new X3.Vector3(-i.x,-i.y,i.z)),r[5]=e.add(new X3.Vector3(i.x,-i.y,i.z)),r[6]=e.add(new X3.Vector3(-i.x,i.y,i.z)),r[7]=e.add(new X3.Vector3(i.x,i.y,i.z));for(var o=[],a=-1,s=0;8>s;s++)n.sectionPlane.distance(r[s])>=0&&(o.push(s),a=s);for(var u=new X3.Box3,l=0;o.length>l;l++)if(u.add(r[l]),-1!==a){var c=n.sectionPlane.intersect(r[a],r[l]);u.add(c)}return u},sliceRange:function(t){var e={},i=Array(8),r=t.center(),o=t.size().divideScalar(2);i[0]=r.add(new X3.Vector3(-o.x,-o.y,-o.z)),i[1]=r.add(new X3.Vector3(o.x,-o.y,-o.z)),i[2]=r.add(new X3.Vector3(-o.x,o.y,-o.z)),i[3]=r.add(new X3.Vector3(o.x,o.y,-o.z)),i[4]=r.add(new X3.Vector3(-o.x,-o.y,o.z)),i[5]=r.add(new X3.Vector3(o.x,-o.y,o.z)),i[6]=r.add(new X3.Vector3(-o.x,o.y,o.z)),i[7]=r.add(new X3.Vector3(o.x,o.y,o.z)),e.min=t.size().length(),e.max=-e.min;for(var a=0;8>a;a++){var s=n.sectionPlane.distance(i[a]);e.min>s&&(e.min=s),s>e.max&&(e.max=s)}return e.min-=n.sectionPlane.distanceOrigin,e.max-=n.sectionPlane.distanceOrigin,e},slicePlane:function(t,e,i){n.sectionPlane.normal=t;var r=n.sliceRange(i);e/=100;var o=r.min+(r.max-r.min)*e;n.sectionPlane.distanceOrigin=o}};return e.pan=function(t,n,i){var r=e.getFrustum(),o=e.getModelViewMatrix(),a=e.getEye(),s=e.getCenter(),u=e.getUp(),l=e.toNdcPoint(t),c=e.toNdcPoint(n),h=l.sub(c);if(r.isPerspective()){h=h.multiplyScalar(e.eye2Center()/2);var f=o.getXAxis().multiplyScalar(h.x),d=o.getYAxis().multiplyScalar(h.y);h=f.add(d)}else{var p=r.getRight(),m=r.getTop();h=h.multiply(new X3.Vector2(p,m)),h=new X3.Vector4(h.x,h.y,0,0);var g=o.invert();h=h.multiplyMatrix4(g),h=h.toVector3()}i&&(h=i.multiplyScalar(h.dot(i)));var v=a.add(h),y=s.add(h),E=u;e.lookAt(v,y,E)},e.rotate=function(t,i,r,o){function a(t,n,i){var r=e.getWindowWidth(),o=e.getWindowHeight(),a=e.getModelViewMatrix();r+=Math.abs(r-2*i.x),o+=Math.abs(o-2*i.y);var s=(r+o)/4,u=(t-i.x)/s,l=(i.y-n)/s,c=new X3.Vector3(u,l,0),h=c.lengthSq();h>1?(c.z=0,c=c.multiplyScalar(1/Math.sqrt(h))):c.z=Math.sqrt(1-h);var f=a.getYAxis().multiplyScalar(c.y);return f=f.add(a.getXAxis().multiplyScalar(c.x)),f=f.add(a.getZAxis().multiplyScalar(c.z))}r||(r=e.getCenter());var s=e.getEye(),u=e.getCenter(),l=e.getUp(),c=e.modelToWindow(r),h=a(t.x,t.y,c),f=a(i.x,i.y,c);o&&(o=o.normalize(),h=h.sub(o.multiplyScalar(h.dot(o))),f=f.sub(o.multiplyScalar(f.dot(o))));var d=Math.acos(h.dot(f)/h.length()/f.length());if(d){var p=h.cross(f).normalize();d*=n.rotateSpeed;var m=new X3.Matrix4;m.setRotationAxis(p,d),r||(r=u);var g=s.sub(r);g=g.toVector4(0).multiplyMatrix4(m).toVector3();var v=g.add(r),y=u.sub(r);y=y.toVector4(0).multiplyMatrix4(m).toVector3();var E=y.add(r),x=l.toVector4(0).multiplyMatrix4(m).toVector3();e.lookAt(v,E,x)}},e.moveToScreenCenter=function(t){var n=e.getModelViewMatrix(),i=new X3.Vector3(t.x,t.y,t.z),r=n.getZAxis().multiplyScalar(-1),o=n.getYAxis(),a=e.getEye(),s=i.sub(a),u=a.add(s.sub(r.multiplyScalar(s.dot(r))));e.lookAt(u,u.add(r.multiplyScalar(e.eye2Center())),o)},e.setSectionPlane=function(t){n.sectionPlane=t},e.getSectionPlane=function(){return n.sectionPlane},e.sectionByLine=function(t,i){n.sectionPlane=new X3.Plane;var r=e.toNdcPoint(new X3.Vector2(t.x,t.y));r=e.unproject(r.toVector3(0));var o=e.toNdcPoint(new X3.Vector2(i.x,i.y));o=e.unproject(o.toVector3(0));var a=e.toNdcPoint(new X3.Vector2(t.x,t.y));return a=e.unproject(a.toVector3(1)),n.sectionPlane.set(r,a,o),n.sectionPlane},e.sectionByPoint=function(t,e){n.sectionPlane=new X3.Plane,e=new X3.Vector3(e.x,e.y,e.z);var i=-e.dot(t);return n.sectionDistance(i),n.sectionNormal(e),n.sectionPlane},e.sectionByAxis=function(t,e){n.sectionPlane=new X3.Plane;var i=-t.dot(e.center());return n.sectionDistance(i),n.sectionNormal(t),n.sectionPlane},e.sectionByPercentage=function(t,e){var i=n.sliceRange(e);t/=100;var r=i.min+(i.max-i.min)*t;return n.sectionPlane.distanceOrigin=-r,n.sectionPlane},e.getSectionPercentage=function(t){var e=n.sliceRange(t),i=-n.sectionPlane.distanceOrigin,r=(i-e.min)/(e.max-e.min);return r*=100},e.sectionRedirect=function(){return n.sectionPlane.normal=n.sectionPlane.normal.negate(),n.sectionPlane.distanceOrigin=-n.sectionPlane.distanceOrigin,n.sectionPlane},e}}.call(this),function(){"use strict";X3.Frustum=function(t,e,n,i,r,o){var a={left:t,right:e,bottom:n,top:i,near:r,far:o,perspective:!0,projection:(new X3.Matrix4).identity(),set:function(t,e,n,i,r,o){t&&(a.left=t),e&&(a.right=e),n&&(a.bottom=n),i&&(a.top=i),r&&(a.near=r),o&&(a.far=o),a.updateProjectionMatrix()},getFovx:function(){return(a.right-a.left)/a.near/2},setFovx:function(t){var e=a.right/a.top;a.right=a.near*t,a.left=-a.right,a.top=a.right/e,a.bottom=-a.top,a.updateProjectionMatrix()},getFovy:function(){return(a.top-a.bottom)/a.near/2},setFovy:function(t){var e=a.right/a.top;a.top=a.near*t,a.bottom=-a.top,a.right=a.top*e,a.left=-a.right,a.updateProjectionMatrix()},getLeft:function(){return a.left},getRight:function(){return a.right},getTop:function(){return a.top},getBottom:function(){return a.bottom},getNear:function(){return a.near},getFar:function(){return a.far},isPerspective:function(){return a.perspective},setPerspective:function(t){a.perspective=t,a.updateProjectionMatrix()},getProjectionMatrix:function(){return a.projection},updateProjectionMatrix:function(){a.projection=a.perspective?X3.Matrix4.createPerspectiveMatrix(a.left,a.right,a.bottom,a.top,a.near,a.far):X3.Matrix4.createOrthographicMatrix(a.left,a.right,a.bottom,a.top,a.near,a.far)}};return{set:a.set,getLeft:a.getLeft,getRight:a.getRight,getBottom:a.getBottom,getTop:a.getTop,getNear:a.getNear,getFar:a.getFar,getFovx:a.getFovx,setFovx:a.setFovx,getFovy:a.getFovy,setFovy:a.setFovy,isPerspective:a.isPerspective,setPerspective:a.setPerspective,getProjectionMatrix:a.getProjectionMatrix}}}.call(this),function(){"use strict";X3.Plane=function(){this.normal=new X3.Vector3(0,0,0),this.distanceOrigin=0},X3.Plane.prototype={constructor:X3.Plane,set:function(t,e,n){var i=t.sub(e),r=n.sub(t);this.normal=r.cross(i),this.normal=this.normal.normalize(),this.distanceOrigin=-this.normal.dot(e)},setDirect:function(t,e){this.normal=t,this.distanceOrigin=e},distance:function(t){return this.normal.dot(t)+this.distanceOrigin},isValid:function(){return 1e-5>Math.abs(this.normal.length()-1)},intersect:function(t,e){if(!this.isValid())return new X3.Vector3;var n=this.distance(t);if(1e-6>Math.abs(n))return t;var i=this.distance(e);if(1e-6>Math.abs(i))return e;var r=e.sub(t),o=e.sub(r.multiplyScalar(i).divideScalar(i-n));return o}}}.call(this),function(){"use strict";X3.EventEmitter=function(){var t={callbacksMap:{},on:function(e,n){var i=t.callbacksMap[e];return i||(i=$.Callbacks(),t.callbacksMap[e]=i),i.add(n),this},emit:function(e,n){var i=t.callbacksMap[e];i&&i.fire(n)},remove:function(e,n){var i=t.callbacksMap[e];i&&i.remove(n)},removeAll:function(e){delete t.callbacksMap[e]}};return{on:t.on,emit:t.emit,remove:t.remove,removeAll:t.removeAll}},X3.emitter=new X3.EventEmitter}.call(this),function(){"use strict";X3.Service=function(){var t={getReferrerURL:function(){var t=parent!==window,e=null;return t&&(e=document&&document.referrer),e},fetchScenes:function(e,n){var i="path="+e,r=t.getReferrerURL();null!=r&&(i+="&referrer="+r);var o=t.buildUrl("",i);t.ajaxGet(o,n)},fetchSelection:function(e,n){var i="path="+e.path,r="&scene="+encodeURIComponent(e.scene),o="&camera="+encodeURIComponent(e.camera),a="&size="+parseInt(e.width,10)+","+parseInt(e.height,10),s="&x="+e.x+"&y="+e.y,u=i+r+a+o+s;if(void 0!==e.section){var l="&section="+e.section;u+=l}if(void 0!==e.selection){var c="&selections="+e.selection;u+=c}var h=t.buildUrl("/selection",u);t.ajaxGet(h,n)},fetchEntity:function(e,n){var i="path="+e.path,r="&scene="+encodeURIComponent(e.scene),o="&id="+e.entityId,a=i+r+o;if(void 0!==e.stName){var s="&stname="+e.stName;a+=s}if(void 0!==e.stPath){var u="&stpath="+e.stPath;a+=u}var l=t.buildUrl("/entities",a);t.ajaxGet(l,n)},fetchStNodes:function(e,n){var i="path="+e.path,r="&scene="+encodeURIComponent(e.scene),o="&stname="+encodeURIComponent(e.stName),a=i+r+o;if(void 0!==e.stPath){var s="&stpath="+e.stPath;a+=s}var u=t.buildUrl("/stnodes",a);t.ajaxGet(u,n)},fetchAssociations:function(e,n){var i="path="+e.path,r="&scene="+encodeURIComponent(e.scene),o="&p="+encodeURIComponent(e.key),a="&v="+encodeURIComponent(e.value),s=i+r+o+a,u=t.buildUrl("/associations",s);t.ajaxGet(u,n)},fetchAssociatedOriginIds:function(e,n){var i="path="+e.path,r="&scene="+encodeURIComponent(e.scene),o="&p="+encodeURIComponent(e.key),a="&v="+encodeURIComponent(e.value),s=i+r+o+a,u=t.buildUrl("/ids",s);t.ajaxGet(u,n)},fetchPropertiesByOriginIds:function(e,n){var i="path="+e.path,r="&scene="+encodeURIComponent(e.scene),o="&ids="+encodeURIComponent(e.originIds),a=i+r+o,s=t.buildUrl("/properties",a);t.ajaxGet(s,n)},depth:function(e,n){var i="path="+e.path,r="&scene="+encodeURIComponent(e.scene),o="&camera="+encodeURIComponent(e.camera),a="&size="+parseInt(e.width,10)+","+parseInt(e.height,10),s="&points="+e.points,u=i+r+o+a+s;if(void 0!==e.section){var l="&section="+e.section;u+=l}var c=t.buildUrl("/depth",u);t.ajaxGet(c,n)},buildImageUrl:function(e){var n="path="+e.path,i="&scene="+encodeURIComponent(e.scene),r="&camera="+encodeURIComponent(e.camera),o="&size="+parseInt(e.width,10)+","+parseInt(e.height,10),a=n+i+r+o;if(void 0!==e.sectionMode){var s="&mode="+parseInt(e.sectionMode,10);a+=s}if(void 0!==e.quality){var u="&quality="+e.quality;a+=u}if(void 0!==e.bgcolor){var l="&bgcolor="+e.bgcolor;a+=l}if(void 0!==e.effect){var c="&effect="+e.effect;a+=c}if(void 0!==e.contourWidth){var h="&contourwidth="+e.contourWidth;a+=h}if(void 0!==e.dotDensity){var f="&dotdensity="+e.dotDensity;a+=f}if(void 0!==e.highlight){var d="&highlight="+e.highlight;a+=d}if(void 0!==e.originIds){var p="&originIds="+e.originIds;a+=p}if(void 0!==e.selection){var m="&selections="+e.selection;a+=m}if(void 0!==e.hiddens){var g="&hiddens="+e.hiddens;a+=g}if(void 0!==e.section){var v="&section="+e.section;a+=v}if(void 0!==e.colors&&(a+="&colors="+encodeURIComponent(e.colors)),void 0!==e.light){var y="&light="+e.light;a+=y}if(void 0!==e.opacity){var E="&opacity="+e.opacity;a+=E}if(void 0!==e.bgTexture){var x="&bgtexture="+e.bgTexture;a+=x}if(void 0!=e.renderingId){var w="&id="+e.renderingId;a+=w}var b="";return e.isBase64?(a+="&format="+e.format,b="/lodimage.json"):b="/image."+e.format,t.buildUrl(b,a)},fetchImageContent:function(e,n){t.ajaxGet(e,function(t,e){200==e?n(null,t):n("cannot get image due to error: "+e,null)})},buildUrl:function(t,e){var n="/services/v3"+t+"?"+e+"&rnd="+Math.random();return n},ajaxGet:function(t,e){$.ajax({url:t,type:"get",dataType:"json",success:function(t){if(t.error)e(null,t.error.code);else{var n=t.data;e(n,200)}},error:function(t){e(null,t.status)}})}};return{fetchScenes:t.fetchScenes,fetchSelection:t.fetchSelection,fetchEntity:t.fetchEntity,fetchStNodes:t.fetchStNodes,fetchAssociations:t.fetchAssociations,depth:t.depth,buildImageUrl:t.buildImageUrl,fetchImageContent:t.fetchImageContent,fetchPropertiesByOriginIds:t.fetchPropertiesByOriginIds,fetchAssociatedOriginIds:t.fetchAssociatedOriginIds}}}(),function(){"use strict";X3.Queue=function(){var t={draftIntervalId:null,draftToClearTimeoutId:null,isDraftDirty:!1,clearTimespan:500,draftTimespan:50,isImageLoaded:!0,callbacks:null,activateDraftInterval:function(){t.draftIntervalId=window.setInterval(t.notifyDraftImageUpdated,t.draftTimespan)},deactivateDraftInterval:function(){window.clearInterval(t.draftIntervalId)},pushDraft:function(){t.isDraftDirty=!0,t.draftToClearTimeoutId&&window.clearTimeout(t.draftToClearTimeoutId),t.draftToClearTimeoutId=window.setTimeout(function(){t.draftImageFinished()},t.clearTimespan)},pushClear:function(){t.draftToClearTimeoutId&&(window.clearTimeout(t.draftToClearTimeoutId),t.draftToClearTimeoutId=null),t.notifyClearImageUpdated()},draftImageFinished:function(){t.notifyClearImageUpdated()},notifyDraftImageUpdated:function(){t.isImageLoaded&&t.isDraftDirty&&(t.callbacks.onDraftImageUpdating(),t.isDraftDirty=!1)},notifyClearImageUpdated:function(){t.isDraftDirty=!1,t.callbacks.onClearImageUpdating()}};return{register:function(e){t.callbacks=e},activateDraftInterval:t.activateDraftInterval,deactivateDraftInterval:t.deactivateDraftInterval,pushDraft:t.pushDraft,setImageStatus:function(e){t.isImageLoaded=e},getImageStatus:function(){return t.isImageLoaded}}}}(),function(){"use strict";X3.MouseListener=function(t,e){var n={callbacks:{},param:{},offset:e,lastX:null,lastY:null,isDown:!1,down:function(t){t?n.callbacks.down=t:n.callbacks.down&&n.callbacks.down(n.param)},move:function(t){t?n.callbacks.move=t:n.callbacks.move&&n.callbacks.move(n.param)},specialMove:function(t){t?n.callbacks.specialMove=t:n.callbacks.specialMove&&n.callbacks.specialMove(n.param)},up:function(t){t?n.callbacks.up=t:n.callbacks.up&&n.callbacks.up(n.param)},cancel:function(t){t?n.callbacks.cancel=t:n.callbacks.cancel&&n.callbacks.cancel(n.param)},wheel:function(t){t?n.callbacks.wheel=t:n.callbacks.wheel&&n.callbacks.wheel(n.param)},getPoint:function(t){var e={};return e.x=t.clientX-n.offset.x,e.y=t.clientY-n.offset.y,e}};return t.mousedown(function(t){t.preventDefault(),t.stopPropagation(),n.param.button=t.which;var e=n.getPoint(t);n.lastX=e.x,n.lastY=e.y,n.param.start={x:e.x,y:e.y},n.param.point=e,n.isDown=!0,n.down()}),t.mousemove(function(t){var e=n.getPoint(t);n.param.from={x:n.lastX,y:n.lastY},n.param.to={x:e.x,y:e.y},n.param.end={x:e.x,y:e.y},n.isDown?(t.preventDefault(),t.stopPropagation(),n.move()):n.specialMove(),n.lastX=e.x,n.lastY=e.y}),t.mouseup(function(t){if(n.isDown){t.preventDefault(),t.stopPropagation();var e=n.getPoint(t);n.param.end={x:e.x,y:e.y},n.lastX=null,n.lastY=null,n.isDown=!1,n.up()}}),t.mouseleave(function(){n.isDown&&(n.lastX=null,n.lastY=null,n.isDown=!1,n.cancel())}),t.mousewheel(function(t,e){return t.preventDefault(),t.stopPropagation(),n.param.delta=e,n.wheel(),!1}),{down:n.down,up:n.up,move:n.move,specialMove:n.specialMove,cancel:n.cancel,wheel:n.wheel,setOffset:function(t){n.offset=t}}}}(),function(){"use strict";X3.TouchListener=function(t,e){var n={callbacks:{},param:{},offset:e,lastX:null,lastY:null,lastFingerDistance:null,isDown:!1,down:function(t){t?n.callbacks.down=t:n.callbacks.down&&n.callbacks.down(n.param)},move:function(t){t?n.callbacks.move=t:n.callbacks.move&&n.callbacks.move(n.param)},up:function(t){t?n.callbacks.up=t:n.callbacks.up&&n.callbacks.up(n.param)},cancel:function(t){t?n.callbacks.cancel=t:n.callbacks.cancel&&n.callbacks.cancel(n.param)},wheel:function(t){t?n.callbacks.wheel=t:n.callbacks.wheel&&n.callbacks.wheel(n.param)},getPoint:function(t){var e={};return e.x=t.clientX-n.offset.x,e.y=t.clientY-n.offset.y,e},touchStart:function(t){var e=t.originalEvent;e.preventDefault(),e.stopPropagation();var i=e.targetTouches;n.param.fingerCount=i.length;var r;if(1===i.length){var o=i[0];r=n.getPoint(o),n.lastX=r.x,n.lastY=r.y,n.param.start={x:r.x,y:r.y},n.param.end={x:r.x,y:r.y},n.param.point=r,n.isDown=!0,n.down()}else if(2===i.length){var a=i[0],s=n.getPoint(a),u=i[1],l=n.getPoint(u);r={},r.x=(s.x+l.x)/2,r.y=(s.y+l.y)/2,n.lastX=r.x,n.lastY=r.y,n.param.start={x:r.x,y:r.y},n.param.end={x:r.x,y:r.y},n.param.point=r,n.isDown=!0,n.down()}},touchMove:function(t){if(n.isDown){var e=t.originalEvent;e.preventDefault(),e.stopPropagation();var i=e.targetTouches;n.param.fingerCount=i.length;var r;if(1===i.length){var o=i[0];r=n.getPoint(o),n.param.from={x:n.lastX,y:n.lastY},n.param.to={x:r.x,y:r.y},n.param.end={x:r.x,y:r.y},n.move(),n.lastX=r.x,n.lastY=r.y}else if(2===i.length){var a=i[0],s=i[1],u=n.getPoint(a),l=n.getPoint(s),c=Math.abs(u.x-l.x),h=Math.abs(u.y-l.y),f=Math.sqrt(c*c+h*h);if(null===n.lastFingerDistance)n.lastFingerDistance=f;else{var d=f-n.lastFingerDistance;Math.abs(d)>20?(n.param.delta=d,n.wheel(),n.lastFingerDistance=f):(r={},r.x=(u.x+l.x)/2,r.y=(u.y+l.y)/2,n.param.from={x:n.lastX,y:n.lastY},n.param.to={x:r.x,y:r.y},n.param.end={x:r.x,y:r.y},n.move(),n.lastX=r.x,n.lastY=r.y)}}}},touchEnd:function(t){if(n.isDown){var e=t.originalEvent;e.preventDefault(),e.stopPropagation(),n.lastX=null,n.lastY=null,n.isDown=!1,n.lastFingerDistance=null,n.up()}},touchCancel:function(t){if(n.isDown){var e=t.originalEvent;e.preventDefault(),e.stopPropagation(),n.lastX=null,n.lastY=null,n.isDown=!1,n.lastFingerDistance=null,n.cancel()}}};return t.bind("touchstart",n.touchStart),t.bind("touchmove",n.touchMove),t.bind("touchend",n.touchEnd),t.bind("touchcancel",n.touchCancel),{down:n.down,up:n.up,move:n.move,cancel:n.cancel,wheel:n.wheel,setOffset:function(t){n.offset=t}}}}(),function(t){"use strict";X3.SteeringListener=function(e,n,i){var r={callbacks:{},isBtnPress:!1,isMovePress:!1,isTurnPress:!1,mr:e.width()/2,tr:n.width()/2,param:{isMoveUp:!1,isMoveDown:!1,mox:e.width()/2,moy:e.height()/2,mx:e.width()/2,my:e.height()/2,tox:n.width()/2,toy:n.height()/2,tx:n.width()/2,ty:n.height()/2},down:function(t){t?r.callbacks.down=t:r.callbacks.down&&r.callbacks.down(r.param)},up:function(t){t?r.callbacks.up=t:r.callbacks.up&&r.callbacks.up(r.param)},esc:function(t){t?r.callbacks.esc=t:r.callbacks.esc&&r.callbacks.esc()},otherBtnDown:function(t){var e=t.attr("data-type");"moveup"===e?r.param.isMoveUp=!0:"movedown"===e&&(r.param.isMoveDown=!0),r.down()},otherBtnUp:function(t){var e=t.attr("data-type");"moveup"===e?r.param.isMoveUp=!1:"movedown"===e&&(r.param.isMoveDown=!1),r.up()}};return t(document).keydown(function(t){87===t.keyCode?(r.param.my=0,r.down()):83===t.keyCode?(r.param.my=2*r.mr,r.down()):65===t.keyCode?(r.param.mx=0,r.down()):68===t.keyCode?(r.param.mx=2*r.mr,r.down()):82===t.keyCode?(r.param.isMoveUp=!0,r.down()):70===t.keyCode?(r.param.isMoveDown=!0,r.down()):38===t.keyCode?(r.param.ty=0,r.down()):40===t.keyCode?(r.param.ty=2*r.tr,r.down()):37===t.keyCode?(r.param.tx=0,r.down()):39===t.keyCode?(r.param.tx=2*r.tr,r.down()):27===t.keyCode&&r.esc()}),t(document).keyup(function(t){87===t.keyCode?(r.param.my=r.mr,r.up()):83===t.keyCode?(r.param.my=r.mr,r.up()):65===t.keyCode?(r.param.mx=r.mr,r.up()):68===t.keyCode?(r.param.mx=r.mr,r.up()):82===t.keyCode?(r.param.isMoveUp=!1,r.up()):70===t.keyCode?(r.param.isMoveDown=!1,r.up()):38===t.keyCode?(r.param.ty=r.tr,r.up()):40===t.keyCode?(r.param.ty=r.tr,r.up()):37===t.keyCode?(r.param.tx=r.tr,r.up()):39===t.keyCode&&(r.param.tx=r.tr,r.up())}),i.mousedown(function(e){1===e.which&&(e.preventDefault(),e.stopPropagation(),r.isBtnPress=!0,r.otherBtnDown(t(this)))}),i.bind("touchstart",function(e){var n=e.originalEvent;n.preventDefault(),n.stopPropagation(),r.isBtnPress=!0,r.otherBtnDown(t(this))}),i.mousemove(function(e){r.isBtnPress&&(e.preventDefault(),e.stopPropagation(),r.otherBtnDown(t(this)))}),i.bind("touchmove",function(e){if(r.isBtnPress){var n=e.originalEvent;n.preventDefault(),n.stopPropagation(),r.otherBtnDown(t(this))}}),i.mouseup(function(e){1===e.which&&r.isBtnPress&&(e.preventDefault(),e.stopPropagation(),r.isBtnPress=!1,r.otherBtnUp(t(this)))}),i.bind("touchend",function(e){if(r.isBtnPress){var n=e.originalEvent;n.preventDefault(),n.stopPropagation(),r.isBtnPress=!1,r.otherBtnUp(t(this))}}),i.bind("touchleave mouseleave",function(){r.otherBtnUp(t(this))}),t(document).mouseup(function(t){1===t.which&&r.isBtnPress&&(r.isBtnPress=!1)}),t(document).bind("touchend",function(){r.isBtnPress&&(r.isBtnPress=!1)}),e.mousedown(function(e){1===e.which&&(e.preventDefault(),e.stopPropagation(),r.param.mx=e.clientX-t(this).offset().left,r.param.my=e.clientY-t(this).offset().top,r.isMovePress=!0,r.down())}),e.bind("touchstart",function(e){var n=e.originalEvent;n.preventDefault(),n.stopPropagation();var i=n.targetTouches,o=i[0];r.param.mx=o.clientX-t(this).offset().left,r.param.my=o.clientY-t(this).offset().top,r.isMovePress=!0,r.down()}),e.mousemove(function(e){r.isMovePress&&(e.preventDefault(),e.stopPropagation(),r.param.mx=e.clientX-t(this).offset().left,r.param.my=e.clientY-t(this).offset().top,r.down())}),e.bind("touchmove",function(e){if(r.isMovePress){var n=e.originalEvent;n.preventDefault(),n.stopPropagation();var i=n.targetTouches,o=i[0];r.param.mx=o.clientX-t(this).offset().left,r.param.my=o.clientY-t(this).offset().top,r.down()}}),e.mouseup(function(t){1===t.which&&r.isMovePress&&(t.preventDefault(),t.stopPropagation(),r.param.mx=r.mr,r.param.my=r.mr,r.isMovePress=!1,r.up())}),e.bind("touchend",function(t){if(r.isMovePress){var e=t.originalEvent;e.preventDefault(),e.stopPropagation(),r.param.mx=r.mr,r.param.my=r.mr,r.isMovePress=!1,r.up()}}),n.mousedown(function(e){1===e.which&&(e.preventDefault(),e.stopPropagation(),r.param.tx=e.clientX-t(this).offset().left,r.param.ty=e.clientY-t(this).offset().top,r.isTurnPress=!0,r.down())}),n.bind("touchstart",function(e){var n=e.originalEvent;n.preventDefault(),n.stopPropagation();var i=n.targetTouches,o=i[0];r.param.tx=o.clientX-t(this).offset().left,r.param.ty=o.clientY-t(this).offset().top,r.isTurnPress=!0,r.down()}),n.mousemove(function(e){r.isTurnPress&&(e.preventDefault(),e.stopPropagation(),r.param.tx=e.clientX-t(this).offset().left,r.param.ty=e.clientY-t(this).offset().top,r.down())}),n.bind("touchmove",function(e){if(r.isTurnPress){var n=e.originalEvent;n.preventDefault(),n.stopPropagation();var i=n.targetTouches,o=i[0];r.param.tx=o.clientX-t(this).offset().left,r.param.ty=o.clientY-t(this).offset().top,r.down()}}),n.mouseup(function(t){1===t.which&&r.isTurnPress&&(t.preventDefault(),t.stopPropagation(),r.param.tx=r.mr,r.param.ty=r.mr,r.isTurnPress=!1,r.up())}),n.bind("touchend",function(t){if(r.isTurnPress){var e=t.originalEvent;e.preventDefault(),e.stopPropagation(),r.param.tx=r.mr,r.param.ty=r.mr,r.isTurnPress=!1,r.up()}}),t(document).mousemove(function(t){r.isMovePress&&(r.param.mx=t.clientX-e.offset().left,r.param.my=t.clientY-e.offset().top,r.down()),r.isTurnPress&&(r.param.tx=t.clientX-n.offset().left,r.param.ty=t.clientY-n.offset().top,r.down())}),t(document).bind("touchmove",function(t){var i=t.originalEvent,o=i.targetTouches,a=o[0];r.isMovePress&&(r.param.mx=a.clientX-e.offset().left,r.param.my=a.clientY-e.offset().top,r.down()),r.isTurnPress&&(r.param.tx=a.clientX-n.offset().left,r.param.ty=a.clientY-n.offset().top,r.down())}),t(document).mouseup(function(t){1===t.which&&(r.isMovePress&&(r.param.mx=r.mr,r.param.my=r.mr,r.isMovePress=!1,r.up()),r.isTurnPress&&(r.param.tx=r.tr,r.param.ty=r.tr,r.isTurnPress=!1,r.up()))}),t(document).bind("touchend",function(){r.isMovePress&&(r.param.mx=r.mr,r.param.my=r.mr,r.isMovePress=!1,r.up()),r.isTurnPress&&(r.param.tx=r.tr,r.param.ty=r.tr,r.isTurnPress=!1,r.up())}),{up:r.up,down:r.down,esc:r.esc}}}(jQuery),function(){X3.Model=function(){"use strict";var t=this;this.emit=X3.emitter.emit,this.service=new X3.Service,this.cameraView=new X3.Camera,this.cameraMap=new X3.Camera,this.path=null,this.defaultSceneName=null,this.scenes=null,this.currentScene=null,this.boundingBox=null,this.gotoBoundingBox=null,this.viewSize={width:0,height:0},this.mapSize={width:0,height:0},this.isRotate=!0,this.originIds=null,this.entityId=null,this.treeUrl=null,this.toHiddens="",this.hiddens=null,this.sectionReverse=!1,this.pivot=null,this.lockType=null,this.lockAxis=null,this.rotateLock=null,this.panLock=null,this.upLock=!1,this.eyeLock=!1,this.quality=null==$.cookie("quality")?79:$.cookie("quality"),this.light=0,this.opacity=9,this.bgcolor="255,255,255",this.highlight=0,this.hasMap=!1,this.isMapMode=!1,this.colorsStr=null,this.bgTexture=0,this.levelProperties=[],this.eyeHeightRatio=.5,this.sectionMode=0,this.sectionPlane=null,this.sectionCenter=null,this.sectionXAxis=null,this.sectionYAxis=null,this.sectionZAxis=null,this.mapEffect=0,this.effect=0,this.draftEffect=0,this.contourWidth=1,this.dotDensity=1,this.updateViewSize=function(t,e){this.viewSize.width=t,this.viewSize.height=e,this.cameraView.resize(t,e)},this.updateMapSize=function(t,e){this.mapSize.width=t,this.mapSize.height=e,this.cameraMap.resize(t,e)},this.load=function(e){this.path=e,this.service.fetchScenes(this.path,function(e,n){200===n?e&&e.scenes&&e.scenes.length>0?(t.scenes=e.scenes,t.emit(X3.Events.SCENES_LOADED,{scenes:t.scenes})):t.emit(X3.Events.SCENES_LOADED_ERROR,{status:400}):t.emit(X3.Events.SCENES_LOADED_ERROR,{status:n})})},this.loadFloorInfo=function(){var e={path:this.path,scene:this.currentScene.name,key:"*_*ElementType",value:"Level"},n=this;n.service.fetchAssociatedOriginIds(e,function(e){for(var i="",r=0;e.ids.length>r;r++)i=i+e.ids[r]+",";n.service.fetchPropertiesByOriginIds({path:n.path,scene:n.currentScene.name,originIds:i},function(e){var i=(e||{}).entities||[];i.length>0&&(n.levelProperties=i.sort(function(t,e){return parseFloat(t.properties.Elevation)-parseFloat(e.properties.Elevation)}),t.emit(X3.Events.LEVEL_INFO_LOADED,n.levelProperties))})})},this.activateScene=function(t){for(var e=null,n=0;this.scenes.length>n;n++){var i=this.scenes[n];if(i.name===t){e=i;break}}if(null===e)throw"SCENE NOT FOUND";this.currentScene=e;var r=new X3.Box3,o=this.currentScene.boundingBox;r.min=new X3.Vector3(o.minX,o.minY,o.minZ),r.max=new X3.Vector3(o.maxX,o.maxY,o.maxZ),this.boundingBox=r;var a={box:r,front:this.currentScene.front};this.cameraMap.init(a),this.cameraView.init(a),e.is3D?this.cameraView.setPerspective(!0):this.cameraView.setPerspective(!1),this.view("front"),this.cameraMap.setPerspective(!1),this.cameraMap.viewTop(this.boundingBox),this.zoomFit();var s=this.cameraMap.getModelViewMatrix().getZAxis();this.cameraMap.setWalkPlaneNormal&&this.cameraView.setWalkPlaneNormal&&(this.cameraMap.setWalkPlaneNormal(s),this.cameraView.setWalkPlaneNormal(s)),this.emit(X3.Events.ACTIVESCENE_CHANGED,this.currentScene)},this.select=function(t,e,n){var i;i=this.isMapMode?this.buildMapParameter():this.buildViewParameter(),i.width=this.viewSize.width,i.height=this.viewSize.height,i.x=t,i.y=e,null!==this.treeUrl&&(i.selection=this.treeUrl),this.service.fetchSelection(i,function(t){t.position,n(t)})},this.selectEntity=function(e,n){this.select(e,n,function(e){t.emit(X3.Events.ENTITY_SELECTED,e)})},this.selectDistancePoint=function(e,n){this.select(e,n,function(e){t.emit(X3.Events.DISTANCEPOINT_SELECTED,e)})},this.selectCutPoint=function(e,n){this.select(e,n,function(e){t.emit(X3.Events.CUT_POINT_SELECTED,e)})},this.selectPivot=function(e,n){this.select(e,n,function(e){t.emit(X3.Events.PIVOT_SELECTED,e)})},this.selectEntityByTree=function(e,n,i){var r={path:this.path,scene:this.currentScene.name,entityId:e,stName:n,stPath:i};this.service.fetchEntity(r,function(e){t.emit(X3.Events.TREENODE_SELECTED,e)})},this.getAssociationIds=function(e,n){var i={path:this.path,scene:this.currentScene.name,key:e,value:n};this.service.fetchAssociations(i,function(e){t.emit(X3.Events.ENTITY_ASSOCIATED,e.ids)})},this.depth=function(e){var n;n=this.isMapMode?this.buildMapParameter():this.buildViewParameter(),n.width=this.viewSize.width,n.height=this.viewSize.height,n.points="";for(var i=0;e.length>i;i++){var r=e[i].position;n.points+=r[0]+","+r[1]+","+r[2],i!==e.length-1&&(n.points+=",")}this.service.depth(n,function(e){t.emit(X3.Events.DEPTH_CALCULATED,e)})},this.getStNodes=function(e,n){var i={path:this.path,scene:this.currentScene.name,stName:e,stPath:n};this.service.fetchStNodes(i,function(e){t.emit(X3.Events.TREE_INITED,e)})},this.lockRotate=function(t){this.panLock=null,this.rotateLock="x"===t?new X3.Vector3(1,0,0):"y"===t?new X3.Vector3(0,1,0):"z"===t?new X3.Vector3(0,0,1):"up"===t?this.cameraView.getFrontAxises().up:null},this.lockPan=function(t){this.rotateLock=null,this.panLock="x"===t?new X3.Vector3(1,0,0):"y"===t?new X3.Vector3(0,1,0):"z"===t?new X3.Vector3(0,0,1):null},this.lockUp=function(){this.upLock=!0},this.lockEye=function(){this.eyeLock=!0},this.pan=function(t,e,n,i){this.isMapMode?this.cameraMap.pan(new X3.Vector2(t,e),new X3.Vector2(n,i)):this.cameraView.pan(new X3.Vector2(t,e),new X3.Vector2(n,i),this.panLock)},this.rotate=function(t,e,n,i){if(this.upLock&&this.eyeLock){var r=this.cameraView.getSceneFront(),o=new X3.Vector3(r[6],r[7],r[8]),a=this.cameraView.getEye(),s=this.cameraView.getCenter(),u=this.cameraView.getUp(),l=u.cross(a.sub(s).normalize());this.cameraView.rotate(new X3.Vector2(t,e),new X3.Vector2(n,i),this.pivot,l),this.cameraView.rotate(new X3.Vector2(t,e),new X3.Vector2(n,i),this.pivot,o)}else this.cameraView.rotate(new X3.Vector2(t,e),new X3.Vector2(n,i),this.pivot,this.rotateLock);this.notifyCameraUpdated()},this.turn=function(t,e){this.cameraView.turn(t,e)},this.walk=function(t,e,n){this.cameraView.walk(t,e,n)},this.updown=function(t){this.cameraView.lift(t)},this.setStep=function(e){var n=e;t.cameraView.setWalkStep(n)},this.gotoEntity=function(){var t=this.gotoBoundingBox;if(t){var e=new X3.Box3;return e.min=new X3.Vector3(t.minX,t.minY,t.minZ),e.max=new X3.Vector3(t.maxX,t.maxY,t.maxZ),this.cameraView.zoomByBoundingBox(e),!0}return!1},this.gotoByPosition=function(t){var e=new X3.Vector3(t.x,t.y,t.z),n=new X3.Box3;n.add(e),n.resize(5),this.cameraView.zoomByBoundingBox(n)},this.zoomFit=function(){this.isMapMode?this.cameraMap.zoomByBoundingBox(this.boundingBox):(this.cameraView.zoomByBoundingBox(this.boundingBox),this.cameraMap.zoomByBoundingBox(this.boundingBox))},this.zoomWindow=function(e,n,i,r){var o=new X3.Vector2(e,n),a=new X3.Vector2(i,r);this.isMapMode?t.cameraMap.zoomByWindow(o,a):t.cameraView.zoomByWindow(o,a)},this.zoomIn=function(){this.isMapMode?this.cameraMap.zoomByFactor(1.1):this.cameraView.zoomByFactor(1.1)},this.zoomOut=function(){this.isMapMode?this.cameraMap.zoomByFactor(.8887):this.cameraView.zoomByFactor(.8887)},this.resetMap=function(){this.cameraMap.zoomByBoundingBox(this.boundingBox)},this.view=function(t){"angle"===t?this.cameraView.viewAngle(this.boundingBox):"front"===t?this.cameraView.viewFront(this.boundingBox):"back"===t?this.cameraView.viewBack(this.boundingBox):"left"===t?this.cameraView.viewLeft(this.boundingBox):"right"===t?this.cameraView.viewRight(this.boundingBox):"top"===t?this.cameraView.viewTop(this.boundingBox):"bottom"===t&&this.cameraView.viewBottom(this.boundingBox),this.notifyCameraUpdated()},this.updatePivot=function(t){void 0!==t&&null!==t?(this.pivot=new X3.Vector3(t.x,t.y,t.z),this.cameraView.moveToScreenCenter(this.pivot)):this.pivot=null,this.notifyCameraUpdated()},this.updatePivotByBoundingBox=function(t){var e=new X3.Box3;e.min=new X3.Vector3(t.minX,t.minY,t.minZ),e.max=new X3.Vector3(t.maxX,t.maxY,t.maxZ),this.pivot=e.center(),this.cameraView.moveToScreenCenter(this.pivot),this.notifyCameraUpdated()},this.sectionByLine=function(t,e,n,i){var r={x:t,y:e},o={x:n,y:i};this.sectionMode=1,this.sectionPlane=this.cameraView.sectionByLine(r,o)},this.sectionByPoint=function(t,e){this.sectionMode=1,this.sectionPlane=this.cameraView.sectionByPoint(t,e)},this.sectionByAxis=function(t){var e;if("x"===t)e=new X3.Vector3(1,0,0);else if("y"===t)e=new X3.Vector3(0,1,0);else{if("z"!==t)throw"UNKNOWN AXIS";e=new X3.Vector3(0,0,1)}this.sectionMode=1,this.sectionPlane=this.cameraView.sectionByAxis(e,this.boundingBox)},this.sectionPercentage=function(t){return t&&this.sectionPlane&&(this.sectionMode=1,this.sectionPlane=this.cameraView.sectionByPercentage(t,this.boundingBox)),this.sectionPlane?this.cameraView.getSectionPercentage(this.boundingBox):50},this.sectionSpecialMode=function(t){this.sectionMode=t,this.sectionCenter=this.boundingBox.center();var e=this.cameraView.getCenter(),n=this.cameraView.getEye(),i=this.cameraView.getUp();this.sectionYAxis=new X3.Vector3(i.x,i.y,i.z),this.sectionZAxis=n.sub(e),this.sectionXAxis=i.cross(this.sectionZAxis)},this.cancelSection=function(){this.sectionMode=0,this.sectionPlane=null,this.sectionCenter=null,this.sectionXAxis=null,this.sectionYAxis=null,this.sectionZAxis=null},this.toggleSectionReverse=function(){1===this.sectionMode&&(this.sectionPlane=this.cameraView.sectionRedirect()),(2===this.sectionMode||3===this.sectionMode)&&(this.sectionXAxis=this.sectionXAxis.negate())
},this.getEyeTriangle=function(t){var e=this.cameraView.getEyePosition(),n=this.cameraMap.modelToWindow(e),i=this.cameraMap.modelToWindow(new X3.Vector3(0,0,0)),r=this.cameraMap.modelToWindow(this.cameraView.getModelViewMatrix().getZAxis().negate()).sub(i).normalize(),o=new X3.Vector2(r.y,-r.x),a=r.add(o.multiplyScalar(.8)).multiplyScalar(t),s=r.add(o.multiplyScalar(-.8)).multiplyScalar(t);return a=a.add(n),s=s.add(n),{origin:n,right:a,left:s}},this.pickPostionFromMap=function(t,e){var n={x:t,y:e},i=this.cameraMap.getWalkPlaneNormal(),r=this.cameraMap.windowToModel(n),o=this.cameraView.getEyePosition().dot(i),a=this.cameraMap.getEyePosition(),s=this.cameraMap.getEyePosition().dot(i),u=r.dot(i);if(u===s)return a;var l=new X3.Vector3(r.x,r.y,r.z).sub(a).multiplyScalar((o-s)/(u-s)).add(a);return l},this.setCurrentPosition=function(t){this.cameraView.setMapPostion(t)},this.initPosition=function(t){var e=t.width/2,n=t.height/2,i=this.pickPostionFromMap(e,n);this.setCurrentPosition(i)},this.buildViewImageUrl=function(t,e,n,i,r){var o=this.buildViewParameter();o.width=t,o.height=e,o.quality=this.quality,this.currentScene.is3D?(o.effect=i?this.effect:this.draftEffect,o.highlight=this.highlight,o.light=this.light,o.opacity=(this.opacity+1)/10,o.bgTexture=this.bgTexture,o.contourWidth=this.contourWidth,o.dotDensity=this.dotDensity,o.format=2===o.effect?"png":this.currentScene.preferFormat,null!==this.originIds&&(o.originIds=this.originIds),null!==this.entityId?o.selection=this.entityId:null!==this.treeUrl&&(o.selection=this.treeUrl),null!==this.hiddens&&(o.hiddens=this.hiddens),null!==this.colorsStr&&(o.colors=this.colorsStr),o.bgcolor=this.bgcolor):o.format="png",o.isBase64=r||!0,o.renderingId=n;var a=this.service.buildImageUrl(o);return a},this.buildMapImageUrl=function(t,e,n){var i=this.buildMapParameter(n);i.width=t,i.height=e,i.quality=80,i.effect=this.mapEffect,i.format=this.currentScene.preferFormat,i.isBase64=!0,i.renderingId=null;var r=this.service.buildImageUrl(i);return r},this.fetchImage=function(e,n){t.service.fetchImageContent(e,n)},this.buildViewParameter=function(){var t={path:this.path,scene:this.currentScene.name,camera:this.arrayToString(this.cameraView.getStatus()),sectionMode:this.sectionMode};if(1===this.sectionMode&&this.sectionPlane){var e=this.sectionPlane.normal.x,n=this.sectionPlane.normal.y,i=this.sectionPlane.normal.z,r=this.sectionPlane.distanceOrigin;t.section=e+","+n+","+i+","+r}return(2===this.sectionMode||3===this.sectionMode)&&(t.section=this.sectionCenter.x+","+this.sectionCenter.y+","+this.sectionCenter.z+","+this.sectionXAxis.x+","+this.sectionXAxis.y+","+this.sectionXAxis.z+","+this.sectionYAxis.x+","+this.sectionYAxis.y+","+this.sectionYAxis.z+","+this.sectionZAxis.x+","+this.sectionZAxis.y+","+this.sectionZAxis.z),t},this.buildMapParameter=function(t){var e=this.cameraView.getEyePosition(),n=this.cameraMap.getWalkPlaneNormal(),i={path:this.path,scene:this.currentScene.name,camera:this.arrayToString(this.cameraMap.getStatus())};return t&&(i.section=""+-n.x+","+-n.y+","+-n.z+","+e.dot(n)),i},this.notifyCameraUpdated=function(){t.emit(X3.Events.CAMERA_CHANGED)},this.arrayToString=function(t){for(var e="",n=0;t.length>n;n++)e+=t[n],e+=",";return e},this.modelToScreen=function(t){return t=new X3.Vector3(t.x,t.y,t.z),this.isMapMode?this.cameraMap.modelToWindow(t):this.cameraView.modelToWindow(t)},this.screenToModel=function(t){return this.isMapMode?this.cameraMap.windowToModel(t):this.cameraView.windowToModel(t)},this.modelToAxisScreen=function(t){return t=new X3.Vector3(t.x,t.y,t.z),this.cameraView.modelToAxis(t)},this.computeEyeCenter=function(){var t=this.cameraView.getModelViewMatrix().getZAxis(),e=this.cameraView.getFrustum().getNear(),n=this.cameraView.getFrustum().getFar(),i=this.cameraView.getEye(),r=this.cameraView.getUp(),o=i.sub(t.multiplyScalar((e+n)/2));this.cameraView.lookAt(i,o,r)},this.resetHorizantal=function(){var t=this.cameraView.getEye(),e=this.cameraView.getCenter();this.cameraView.getUp();var n=this.cameraView.getWalkPlaneNormal(),i=t.sub(e),r=i.sub(n.multiplyScalar(i.dot(n)));this.cameraView.lookAt(t,t.sub(r),n)},this.activateLimitPlane=function(){this.cameraView.activateLimitPlane()},this.activateLimitAngle=function(t,e){var n=null,i=null;if("x"===t)n=new X3.Vector3(1,0,0);else if("y"===t)n=new X3.Vector3(0,1,0);else if("z"===t)n=new X3.Vector3(0,0,1);else if("up"===t){var r=this.cameraView.getSceneFront();n=new X3.Vector3(r[6],r[7],r[8])}else n=null;i=Math.cos(e*Math.PI/180),this.cameraView.activateLimitAngle(n,i)},this.status=function(t){if(void 0===t){var e=this.cameraView.getEye(),n=this.cameraView.getCenter(),i=this.cameraView.getUp(),r=this.cameraView.getFrustum();return{eye:this.cameraView.getEye(),center:this.cameraView.getCenter(),up:this.cameraView.getUp(),frustum:{left:r.getLeft(),right:r.getRight(),bottom:r.getBottom(),top:r.getTop(),near:r.getNear(),far:r.getFar()},sectionPlane:this.sectionPlane,currentScene:this.currentScene,pivot:this.pivot,lockType:this.lockType,lockAxis:this.lockAxis,originIds:this.originIds,entityId:this.entityId,treeUrl:this.treeUrl,toHiddens:this.toHiddens,hiddens:this.hiddens,gotoBoundingBox:this.gotoBoundingBox,effect:this.effect,draftEffect:this.draftEffect,light:this.light,opacity:this.opacity,bgcolor:this.bgcolor,highlight:this.highlight}}if(this.currentScene.name!==t.currentScene.name){this.currentScene=t.currentScene;var o=new X3.Box3,a=this.currentScene.boundingBox;o.min=new X3.Vector3(a.minX,a.minY,a.minZ),o.max=new X3.Vector3(a.maxX,a.maxY,a.maxZ),this.boundingBox=o;var s={box:o,front:this.currentScene.front};this.cameraMap.init(s),this.cameraView.init(s),t.currentScene.is3D?this.cameraView.setPerspective(!0):this.cameraView.setPerspective(!1),this.view("front"),this.cameraMap.setPerspective(!1),this.cameraMap.viewTop(this.boundingBox),this.zoomFit();var u=this.cameraMap.getModelViewMatrix().getZAxis();this.cameraMap.setWalkPlaneNormal&&this.cameraView.setWalkPlaneNormal&&(this.cameraMap.setWalkPlaneNormal(u),this.cameraView.setWalkPlaneNormal(u))}var e=new X3.Vector3(t.eye.x,t.eye.y,t.eye.z),n=new X3.Vector3(t.center.x,t.center.y,t.center.z),i=new X3.Vector3(t.up.x,t.up.y,t.up.z);if(t.currentScene.is3D)this.cameraView.lookAt(e,n,i);else{var l=t.frustum.right/t.frustum.near,c=t.frustum.top/t.frustum.near,h=Math.max(l,c),f=this.viewSize.width/this.viewSize.height;1>f?this.cameraView.getFrustum().setFovy(h):this.cameraView.getFrustum().setFovx(h),this.cameraView.lookAt(e,n,i)}if(t.sectionPlane){var d=new X3.Plane;d.normal.set(t.sectionPlane.normal.x,t.sectionPlane.normal.y,t.sectionPlane.normal.z),d.distanceOrigin=t.sectionPlane.distanceOrigin,this.cameraView.setSectionPlane(d),this.sectionPlane=t.sectionPlane}else this.sectionPlane=null;this.pivot=t.pivot?new X3.Vector3(t.pivot.x,t.pivot.y,t.pivot.z):null,this.lockType=t.lockType,this.lockAxis=t.lockAxis,this.originIds=t.originIds,this.entityId=t.entityId,this.treeUrl=t.treeUrl,this.toHiddens=t.toHiddens,this.hiddens=t.hiddens,this.gotoBoundingBox=t.gotoBoundingBox,this.effect=t.effect,this.draftEffect=t.draftEffect,this.light=t.light,this.opacity=t.opacity,this.bgcolor=t.bgcolor,this.highlight=t.highlight},this.getFloorInfo=function(){for(var t={name:"--",isLastFloor:!1,elevation:null,nextFloor:null},e=this.cameraView.getEye().z,n=0;this.levelProperties.length>n;n++){var i=e>=parseFloat(this.levelProperties[n].properties.Elevation),r=n===this.levelProperties.length-1,o=r?i:i&&parseFloat(this.levelProperties[n+1].properties.Elevation)>e;if(o){t.name=this.levelProperties[n].properties["*_*ElementName"],t.isLastFloor=r,t.elevation=this.levelProperties[n].properties.Elevation,t.nextFloor=r?null:this.levelProperties[n+1].properties.Elevation,t.index=n;break}}return t},this.liftWithFloor=function(t,e){var n=t;void 0!==e&&null!==e&&this.levelProperties.length-1>e?n+=this.eyeHeightRatio*(this.levelProperties[e+1].properties.Elevation-t):void 0!==e&&null!==e&&e===this.levelProperties.length-1&&1!==this.levelProperties.length&&(n+=this.eyeHeightRatio*(t-this.levelProperties[e-1].properties.Elevation));var i=this.cameraView.getEye(),r=new X3.Vector3(i.x,i.y,n);this.cameraView.setEyePosition(r)}}}(),function(){"use strict";X3.Mediator=function(t){var e=this;e.view=t.view,e.queue=t.queue,e.emit=X3.emitter.emit,e.canGetDraft=!0,e.canGetClear=!0,e.canEsc=!0,e.isRemoteStatus=!0,e.isDraftSync=!1,e.needDraftSync=!0,e.isMapDirty=!1,e.isWalkMode=!1,e.$operateLayer=null,e.$selectPointLayer=null,e.$drawLineLayer=null,e.$drawPointLineLayer=null,e.$drawLaserPointLayer=null,e.$selectRectangeLayer=null,e.$mapOperateLayer=null,e.$steeringMoveLayer=null,e.$steeringTurnLayer=null,e.$steeringDirectionBtn=null,e.getOffset=null,e.operateMouseListener=null,e.operateTouchListener=null,e.pointMouseListener=null,e.pointTouchListener=null,e.lineMouseListener=null,e.lineTouchListener=null,e.pointLineMouseListener=null,e.pointLineTouchListener=null,e.laserPointMouseListener=null,e.laserPointTouchListener=null,e.rectMouseListener=null,e.rectTouchListener=null,e.mapMouseListener=null,e.mapTouchListener=null,e.steeringListener=null,e.init=function(t){e.getOffset=t.getOffset,t.operateLayer&&(e.$operateLayer=t.operateLayer,e.operateMouseListener=new X3.MouseListener(e.$operateLayer,e.getOffset()),e.operateTouchListener=new X3.TouchListener(e.$operateLayer,e.getOffset()),e.operateMouseListener.down(function(t){e.emit(X3.Events.VIEWER_OPERATION_DOWN,t)}),e.operateMouseListener.move(function(t){e.emit(X3.Events.VIEWER_OPERATION_MOVE,t)}),e.operateMouseListener.up(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t)}),e.operateMouseListener.cancel(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t)}),e.operateMouseListener.wheel(function(t){e.emit(X3.Events.VIEWER_OPERATION_WHEEL,t)}),e.operateTouchListener.down(function(t){e.emit(X3.Events.VIEWER_OPERATION_DOWN,t)}),e.operateTouchListener.move(function(t){e.emit(X3.Events.VIEWER_OPERATION_MOVE,t)}),e.operateTouchListener.up(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t)}),e.operateTouchListener.cancel(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t)}),e.operateTouchListener.wheel(function(t){e.emit(X3.Events.VIEWER_OPERATION_WHEEL,t)})),t.selectPointLayer&&(e.$selectPointLayer=t.selectPointLayer,e.pointMouseListener=new X3.MouseListener(e.$selectPointLayer,e.getOffset()),e.pointTouchListener=new X3.TouchListener(e.$selectPointLayer,e.getOffset()),e.pointMouseListener.down(function(t){e.emit(X3.Events.VIEWER_HELPER_LAYER_POINT_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_DOWN,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_POINT_VISIABLE_CHANGED,!1)}),e.pointTouchListener.down(function(t){e.emit(X3.Events.VIEWER_HELPER_LAYER_POINT_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_DOWN,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_POINT_VISIABLE_CHANGED,!1)})),t.drawLineLayer&&(e.$drawLineLayer=t.drawLineLayer,e.lineMouseListener=new X3.MouseListener(e.$drawLineLayer,e.getOffset()),e.lineTouchListener=new X3.TouchListener(e.$drawLineLayer,e.getOffset()),e.lineMouseListener.down(function(t){e.canEsc=!1,e.emit(X3.Events.VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_DOWN,t)}),e.lineMouseListener.move(function(t){e.emit(X3.Events.VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_MOVE,t)}),e.lineMouseListener.up(function(t){e.canEsc=!0,e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED,!1)}),e.lineMouseListener.cancel(function(t){e.canEsc=!0,e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED,!1)}),e.lineTouchListener.down(function(t){e.emit(X3.Events.VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_DOWN,t)}),e.lineTouchListener.move(function(t){e.emit(X3.Events.VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_MOVE,t)}),e.lineTouchListener.up(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED,!1)}),e.lineTouchListener.cancel(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED,!1)})),t.drawPointLineLayer&&(e.$drawPointLineLayer=t.drawPointLineLayer,e.pointLineMouseListener=new X3.MouseListener(e.$drawPointLineLayer,e.getOffset()),e.pointLineTouchListener=new X3.TouchListener(e.$drawPointLineLayer,e.getOffset()),e.pointLineMouseListener.down(function(t){e.emit(X3.Events.VIEWER_HELPER_LAYER_POINTLINE_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_DOWN,t)}),e.pointLineMouseListener.move(function(t){e.emit(X3.Events.VIEWER_OPERATION_MOVE,t)}),e.pointLineMouseListener.up(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_POINTLINE_VISIABLE_CHANGED,!1)}),e.pointLineMouseListener.cancel(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_POINTLINE_VISIABLE_CHANGED,!1)}),e.pointLineTouchListener.down(function(t){e.emit(X3.Events.VIEWER_HELPER_LAYER_POINTLINE_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_DOWN,t)}),e.pointLineTouchListener.move(function(t){e.emit(X3.Events.VIEWER_OPERATION_MOVE,t)}),e.pointLineTouchListener.up(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_POINTLINE_VISIABLE_CHANGED,!1)}),e.pointLineTouchListener.cancel(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_POINTLINE_VISIABLE_CHANGED,!1)})),t.drawLaserPointLayer&&(e.$drawLaserPointLayer=t.drawLaserPointLayer,e.laserPointMouseListener=new X3.MouseListener(e.$drawLaserPointLayer,e.getOffset()),e.laserPointTouchListener=new X3.TouchListener(e.$drawLaserPointLayer,e.getOffset()),e.laserPointMouseListener.down(function(t){e.emit(X3.Events.VIEWER_HELPER_LAYER_LASERPOINT_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_DOWN,t)}),e.laserPointMouseListener.move(function(t){e.emit(X3.Events.VIEWER_OPERATION_MOVE,t)}),e.laserPointMouseListener.specialMove(function(t){e.emit(X3.Events.VIEWER_HELPER_LAYER_LASERPOINT_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_SPECIALMOVE,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_LASERPOINT_VISIABLE_CHANGED,!1)}),e.laserPointMouseListener.up(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_LASERPOINT_VISIABLE_CHANGED,!1)}),e.laserPointMouseListener.cancel(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_LASERPOINT_VISIABLE_CHANGED,!1)}),e.laserPointTouchListener.down(function(t){e.emit(X3.Events.VIEWER_HELPER_LAYER_LASERPOINT_VISIABLE_CHANGED,!0),e.emit(X3.Events.VIEWER_OPERATION_DOWN,t)}),e.laserPointTouchListener.move(function(t){e.emit(X3.Events.VIEWER_OPERATION_MOVE,t)}),e.laserPointTouchListener.up(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_LASERPOINT_VISIABLE_CHANGED,!1)}),e.laserPointTouchListener.cancel(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_LASERPOINT_VISIABLE_CHANGED,!1)})),t.selectRectangeLayer&&(e.$selectRectangeLayer=t.selectRectangeLayer,e.rectMouseListener=new X3.MouseListener(e.$selectRectangeLayer,e.getOffset()),e.rectTouchListener=new X3.TouchListener(e.$selectRectangeLayer,e.getOffset()),e.rectMouseListener.down(function(){e.emit(X3.Events.VIEWER_HELPER_LAYER_RECT_VISIABLE_CHANGED,!0)}),e.rectMouseListener.move(function(t){e.emit(X3.Events.VIEWER_OPERATION_MOVE,t)}),e.rectMouseListener.up(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_RECT_VISIABLE_CHANGED,!1)}),e.rectMouseListener.cancel(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_RECT_VISIABLE_CHANGED,!1)}),e.rectTouchListener.down(function(){e.emit(X3.Events.VIEWER_HELPER_LAYER_RECT_VISIABLE_CHANGED,!0)}),e.rectTouchListener.move(function(t){e.emit(X3.Events.VIEWER_OPERATION_MOVE,t)}),e.rectTouchListener.up(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_RECT_VISIABLE_CHANGED,!1)}),e.rectTouchListener.cancel(function(t){e.emit(X3.Events.VIEWER_OPERATION_UP,t),e.emit(X3.Events.VIEWER_HELPER_LAYER_RECT_VISIABLE_CHANGED,!1)})),t.mapOperateLayer&&(e.$mapOperateLayer=t.mapOperateLayer,e.mapMouseListener=new X3.MouseListener(e.$mapOperateLayer,e.getOffset()),e.mapTouchListener=new X3.TouchListener(e.$mapOperateLayer,e.getOffset()),e.mapMouseListener.down(function(t){e.emit(X3.Events.VIEWER_MAP_DOWN,t)}),e.mapMouseListener.move(function(t){e.emit(X3.Events.VIEWER_MAP_MOVE,t)}),e.mapTouchListener.down(function(t){e.emit(X3.Events.VIEWER_MAP_DOWN,t)}),e.mapTouchListener.move(function(t){e.emit(X3.Events.VIEWER_MAP_MOVE,t)})),t.steeringMoveLayer&&t.steeringTurnLayer&&t.steeringDirectionBtn&&(e.$steeringMoveLayer=t.steeringMoveLayer,e.$steeringTurnLayer=t.steeringTurnLayer,e.$steeringDirectionBtn=t.steeringDirectionBtn,e.steeringListener=new X3.SteeringListener(e.$steeringMoveLayer,e.$steeringTurnLayer,e.$steeringDirectionBtn),e.steeringListener.down(function(t){e.emit(X3.Events.VIEWER_STEERING_DOWN,t)}),e.steeringListener.up(function(t){e.emit(X3.Events.VIEWER_STEERING_UP,t)}),e.steeringListener.esc(function(){e.canEsc&&(e.view.hideDistanceLayer(),e.view.treeview.cancelSelected(),e.emit(X3.Events.ENTITY_CANCEL))}))},e.resetOffset=function(){null!==e.operateMouseListener&&e.operateMouseListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.operateTouchListener&&e.operateTouchListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.pointMouseListener&&e.pointMouseListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.pointTouchListener&&e.pointTouchListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.lineMouseListener&&e.lineMouseListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.lineTouchListener&&e.lineTouchListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.pointLineMouseListener&&e.pointLineMouseListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.pointLineTouchListener&&e.pointLineTouchListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.laserPointMouseListener&&e.laserPointMouseListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.laserPointTouchListener&&e.laserPointTouchListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.rectMouseListener&&e.rectMouseListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.rectTouchListener&&e.rectTouchListener.setOffset(e.getOffset(e.$operateLayer)),null!==e.mapMouseListener&&e.mapMouseListener.setOffset(e.getOffset(e.$mapOperateLayer)),null!==e.mapTouchListener&&e.mapTouchListener.setOffset(e.getOffset(e.$mapOperateLayer))},e.queue.register({onDraftImageUpdating:function(){e.canGetDraft&&e.emit(X3.Events.DRAFTIMAGE_UPDATING)},onClearImageUpdating:function(){e.canGetClear&&e.emit(X3.Events.CLEARIMAGE_UPDATING)}}),e.activateDraftInterval=function(){e.queue.activateDraftInterval()},e.pushDraft=function(){e.queue.pushDraft(),!e.isRemoteStatus&&e.needDraftSync&&(e.isDraftSync=!0,e.emit(X3.Events.API_STATUS_SYNCHRONIZING))},e.pushMap=function(){e.isMapDirty=!0},e.updateAxis=function(){e.emit(X3.Events.VIEWER_AXIS_UPDATING)},e.getImageStatus=function(){return e.queue.getImageStatus()},e.setImageStatus=function(t){e.queue.setImageStatus(t)},e.initializeParam=function(){e.emit(X3.Events.VIEWER_PARAM_INITIALIZE)},e.onWindowResized=function(){e.emit(X3.Events.VIEWER_WINDOW_RESIZED)},e.onScenesLoaded=function(t){e.emit(X3.Events.VIEWER_SCENES_LOADED,t)},e.onScenesLoadError=function(t){e.emit(X3.Events.VIEWER_SCENES_LOADED_ERROR,t)},e.onLevelInfoLoaded=function(){e.emit(X3.Events.VIEWER_LEVEL_INFO_LOADED)},e.onScenesUpdated=function(){e.emit(X3.Events.TREE_INITING),e.emit(X3.Events.FEATUREPOINT_SETTING),e.emit(X3.Events.VIEWER_SCENES_UPDATED)},e.onSceneChanged=function(t){e.emit(X3.Events.CUT_CANCEL),e.emit(X3.Events.PIVOT_CANCEL),e.emit(X3.Events.LOCK_BUTTON_CLICKED,{lockType:null,axis:null,isSelected:!0}),e.canGetDraft=t.is3D?!0:!1,e.emit(X3.Events.VIEWER_ACTIVESCENE_CHANGED,{scene:t})},e.onDraftImageUpdating=function(t,n,i){e.emit(X3.Events.VIEWER_DRAFT_UPDATING,{base64Image:t,isWalkMode:n,isMapMode:i})},e.onClearImageUpdating=function(t,n,i){e.emit(X3.Events.VIEWER_CLEAR_UPDATING,{base64Image:t,isWalkMode:n,isMapMode:i})},e.onMapUpdating=function(t,n,i){e.emit(X3.Events.VIEWER_MAP_UPDATING,{base64Image:t,isWalkMode:n,isMapMode:i})},e.onSpecialPreviewImageUpdating=function(t,n){e.emit(X3.Events.VIEWER_SPECIALPREVIEW_UPDATING,{base64Image:t,effect:n})},e.onClearImageUpdated=function(){e.emit(X3.Events.VIEWER_CLEARIMAGE_UPDATED),e.emit(X3.Events.FEATUREPOINT_UPDATING)},e.onZoomWindowSelecting=function(t,n){e.emit(X3.Events.ZOOMWINDOW_SELECTING,{start:t,end:n})},e.onZoomWindowSelected=function(){e.emit(X3.Events.VIEWER_ZOOMWINDOW_SELECTED)},e.onGeneralWalkSwitched=function(t,n){e.isWalkMode=t,t&&(e.emit(X3.Events.PIVOT_CANCEL),n&&e.emit(X3.Events.MAP_SWITCHED,!1)),e.emit(X3.Events.VIEWER_GENERAL_WALK_SWITCHED,{isWalkMode:t}),e.isRemoteStatus||(e.isDraftSync=!1,e.emit(X3.Events.API_STATUS_SYNCHRONIZING))},e.onMapSwitched=function(t){e.emit(X3.Events.VIEWER_MAP_SWITCHED,{isMapMode:t})},e.onHighlightSwitched=function(t){e.emit(X3.Events.VIEWER_HIGHLIGHT_SWITCHED,{highlight:t})},e.onDistanceCalculating=function(t,n,i,r){e.emit(X3.Events.DISTANCE_CALCULATING,{start3d:t,end3d:n,start2d:i,end2d:r})},e.onDistanceCalculated=function(t,n,i,r,o,a){e.emit(X3.Events.VIEWER_DISTANCE_CALCULATED,{distance:t,dx:n,dy:i,dz:r,start2d:o,end2d:a})},e.onEffectChanged=function(t){e.emit(X3.Events.VIEWER_EFFECT_CHANGED,{effect:t})},e.onCutPointSelecting=function(t,n){e.emit(X3.Events.CUT_POINT_SELECTING,{x:t,y:n})},e.onCutLineSelecting=function(t,n){e.emit(X3.Events.CUT_LINE,{start:t,end:n})},e.onCutCustomerSelected=function(t){e.emit(X3.Events.VIEWER_CUT_CUSTOMER,{range:t})},e.onCutAxisSelected=function(t,n){e.emit(X3.Events.VIEWER_CUT_AXIS,{axis:t,range:n})},e.onCutRedirectChanged=function(t,n){e.emit(X3.Events.VIEWER_CUT_DIRECTION_CHANGED,{direct:t,range:n})},e.onCutCanceled=function(t){e.emit(X3.Events.VIEWER_CUT_CANCEL,{range:t})},e.onCutSpecialMode=function(t){e.emit(X3.Events.VIEWER_CUT_SPECIAL_MODE,{mode:t})},e.onPivotSelecting=function(t){e.emit(X3.Events.PIVOT_SELECTING,t)},e.onEntitySelecting=function(t){e.emit(X3.Events.ENTITY_SELECTING,t)},e.onEntitySelected=function(t,n){e.emit(X3.Events.VIEWER_ENTITY_SELECTED,{isEntitySelected:t,entity:n})},e.onEntityCancel=function(){e.emit(X3.Events.VIEWER_ENTITY_CANCEL)},e.onEntityHide=function(){e.emit(X3.Events.VIEWER_ENTITY_HIDE)},e.onTreeIniting=function(t){e.emit(X3.Events.VIEWER_TREE_INITING,{hasTree:t})},e.onTreeInited=function(t,n,i){e.emit(X3.Events.VIEWER_TREE_INITED,{currentScene:t,modelPath:n,stNodes:i})},e.onTreeNodeSelecting=function(t,n){e.emit(X3.Events.VIEWER_TREENODE_SELECTING,{canGoto:t,isSingleEntity:n})},e.onTreeNodeSelected=function(t){e.emit(X3.Events.VIEWER_TREENODE_SELECTED,{properties:t})},e.onTreeNodeCancel=function(){e.emit(X3.Events.VIEWER_TREENODE_CANCEL)},e.onAxisLocked=function(t,n){e.emit(X3.Events.VIEWER_AXIS_LOCKED,{lockType:t,lockAxis:n})},e.onFeaturePointSetting=function(){e.emit(X3.Events.VIEWER_FEATUREPOINT_SETTING)},e.onFeaturePointAdding=function(t){e.emit(X3.Events.VIEWER_FEATUREPOINT_ADDING,{featurePoint:t})},e.onFeaturePointDeleting=function(t){e.emit(X3.Events.VIEWER_FEATUREPOINT_DELETING,t)},e.onFeaturePointUpdating=function(){e.emit(X3.Events.VIEWER_FEATUREPOINT_UPDATING)},e.onFeaturePointClearing=function(){e.emit(X3.Events.VIEWER_FEATUREPOINT_CLEARING)},e.onDepthCalculating=function(t){e.emit(X3.Events.DEPTH_CALCULATING,{featurePoints:t})},e.onDepthCalculated=function(t){e.emit(X3.Events.VIEWER_DEPTH_CALCULATED,{depthResult:t})},e.onOpacityChanged=function(t,n){e.emit(X3.Events.VIEWER_OPACITY_CHANGED,{isOpacity:t,effect:n})}}}.call(this),function(){"use strict";X3.Events={APP_STARTED:"APP_STARTED",SCENES_LOADED:"SCENES_LOADED",SCENES_LOADED_ERROR:"SCENES_LOADED_ERROR",ACTIVESCENE_CHANGED:"ACTIVESCENE_CHANGED",CAMERA_CHANGED:"CAMERA_CHANGED",SPECIAL_EFFECT_IMAGE_UPDATING:"SPECIAL_EFFECT_IMAGE_UPDATING",GENERAL_WALK_SWITCHED:"GENERAL_WALK_SWITCHED",HIGHLIGHT_SWITCHED:"HIGHLIGHT_SWITCHED",MAP_SWITCHED:"MAP_SWITCHED",ROTATE_BUTTON_CLICKED:"ROTATE_BUTTON_CLICKED",PAN_BUTTON_CLICKED:"PAN_BUTTON_CLICKED",ZOOMIN_BUTTON_CLICKED:"ZOOMIN_BUTTON_CLICKED",ZOOMOUT_BUTTON_CLICKED:"ZOOMOUT_BUTTON_CLICKED",ZOOMFIT_BUTTON_CLICKED:"ZOOMFIT_BUTTON_CLICKED",ZOOMWINDOW_SELECTING:"ZOOMWINDOW_SELECTING",VIEWPORT_BUTTON_CLICKED:"VIEWPORT_BUTTON_CLICKED",DISTANCEPOINT_SELECTED:"DISTANCEPOINT_SELECTED",DISTANCE_CALCULATING:"DISTANCE_CALCULATING",SELECTTYPE_CHANGED:"SELECTTYPE_CHANGED",ENTITY_SELECTING:"ENTITY_SELECTING",ENTITY_SELECTED:"ENTITY_SELECTED",ENTITY_ASSOCIATING:"ENTITY_ASSOCIATING",ENTITY_ASSOCIATED:"ENTITY_ASSOCIATED",ENTITY_HIDE:"ENTITY_HIDE",ENTITY_HIDE_CANCEL:"ENTITY_HIDE_CANCEL",ENTITY_CANCEL:"ENTITY_CANCEL",ENTITY_GOTO:"ENTITY_GOTO",POSITION_GOTO:"POSITION_GOTO",PIVOT_SELECTING:"PIVOT_SELECTING",PIVOT_SELECTED:"PIVOT_SELECTED",PIVOT_CANCEL:"PIVOT_CANCEL",CUT_AXIS:"CUT_AXIS",CUT_POINT_SELECTING:"CUT_POINT_SELECTING",CUT_POINT_SELECTED:"CUT_POINT_SELECTED",CUT_LINE:"CUT_LINE",CUT_DIRECTION_CHANGED:"CUT_DIRECTION_CHANGED",CUT_RANGE_CHANGED:"CUT_RANGE_CHANGED",CUT_CANCEL:"CUT_CANCEL",CUT_SPECIAL_MODE:"CUT_SPECIAL_MODE",AXIS_LOCKED:"AXIS_LOCKED",TREE_INITING:"TREE_INITING",TREE_INITED:"TREE_INITED",TREENODE_SELECTING:"TREENODE_SELECTING",TREENODE_SELECTED:"TREENODE_SELECTED",TREENODE_CANCEL:"TREENODE_CANCEL",FEATUREPOINT_SETTING:"FEATUREPOINT_SETTING",FEATUREPOINT_ADDING:"FEATUREPOINT_ADDING",FEATUREPOINT_DELETING:"FEATUREPOINT_DELETING",FEATUREPOINT_CLEARING:"FEATUREPOINT_CLEARING",FEATUREPOINT_UPDATING:"FEATUREPOINT_UPDATING",DEPTH_CALCULATING:"DEPTH_CALCULATING",DEPTH_CALCULATED:"DEPTH_CALCULATED",QUALITY_CHANGED:"QUALITY_CHANGED",EFFECT_CHANGED:"EFFECT_CHANGED",BGCOLOR_CHANGED:"BGCOLOR_CHANGED",STEP_CHANGED:"STEP_CHANGED",BRIGHTNESS_CHANGED:"BRIGHTNESS_CHANGED",OPACITY_CHANGED:"OPACITY_CHANGED",PROJECTION_CHANGED:"PROJECTION_CHANGED",CONTOUR_WIDTH_CHANGED:"CONTOUR_WIDTH_CHANGED",DOT_DENSITY_CHANGED:"DOT_DENSITY_CHANGED",DRAFTIMAGE_UPDATING:"DRAFTIMAGE_UPDATING",CLEARIMAGE_UPDATING:"CLEARIMAGE_UPDATING",CLEARMAP_UPDATING:"CLEARMAP_UPDATING",IMAGE_LOADED:"IMAGE_LOADED",WINDOW_RESIZED:"WINDOW_RESIZED",STATUS_SYNCHRONIZING:"STATUS_SYNCHRONIZING",LEVEL_INFO_LOADED:"LEVEL_INFO_LOADED",HAS_MAP_CHANGED:"HAS_MAP_CHANGED",VIEWER_PARAM_INITIALIZE:"VIEWER_PARAM_INITIALIZE",VIEWER_WINDOW_RESIZED:"VIEWER_WINDOW_RESIZED",VIEWER_CLEARIMAGE_UPDATED:"VIEWER_CLEARIMAGE_UPDATED",VIEWER_SCENES_LOADED:"VIEWER_SCENES_LOADED",VIEWER_SCENES_LOADED_ERROR:"VIEWER_SCENES_LOADED_ERROR",VIEWER_SCENES_UPDATED:"VIEWER_SCENES_UPDATED",VIEWER_ACTIVESCENE_CHANGED:"VIEWER_ACTIVESCENE_CHANGED",VIEWER_LEVEL_INFO_LOADED:"VIEWER_LEVEL_INFO_LOADED",VIEWER_AXIS_UPDATING:"VIEWER_AXIS_UPDATING",VIEWER_DRAFT_UPDATING:"VIEWER_DRAFT_UPDATING",VIEWER_CLEAR_UPDATING:"VIEWER_CLEAR_UPDATING",VIEWER_MAP_UPDATING:"VIEWER_MAP_UPDATING",VIEWER_SPECIALPREVIEW_UPDATING:"VIEWER_SPECIALPREVIEW_UPDATING",VIEWER_ZOOMWINDOW_SELECTED:"VIEWER_ZOOMWINDOW_SELECTED",VIEWER_GENERAL_WALK_SWITCHED:"VIEWER_GENERAL_WALK_SWITCHED",VIEWER_HIGHLIGHT_SWITCHED:"VIEWER_HIGHLIGHT_SWITCHED",VIEWER_MAP_SWITCHED:"VIEWER_MAP_SWITCHED",VIEWER_DISTANCE_CALCULATED:"VIEWER_DISTANCE_CALCULATED",VIEWER_CUT_AXIS:"VIEWER_CUT_AXIS",VIEWER_CUT_CUSTOMER:"VIEWER_CUT_CUSTOMER",VIEWER_CUT_DIRECTION_CHANGED:"VIEWER_CUT_DIRECTION_CHANGED",VIEWER_CUT_CANCEL:"VIEWER_CUT_CANCEL",VIEWER_CUT_SPECIAL_MODE:"VIEWER_CUT_SPECIAL_MODE",VIEWER_ENTITY_SELECTED:"VIEWER_ENTITY_SELECTED",VIEWER_ENTITY_CANCEL:"VIEWER_ENTITY_CANCEL",VIEWER_ENTITY_HIDE:"VIEWER_ENTITY_HIDE",VIEWER_TREE_INITING:"VIEWER_TREE_INITING",VIEWER_TREE_INITED:"VIEWER_TREE_INITED",VIEWER_TREENODE_SELECTING:"VIEWER_TREENODE_SELECTING",VIEWER_TREENODE_SELECTED:"VIEWER_TREENODE_SELECTED",VIEWER_TREENODE_CANCEL:"VIEWER_TREENODE_CANCEL",VIEWER_AXIS_LOCKED:"VIEWER_AXIS_LOCKED",VIEWER_FEATUREPOINT_SETTING:"VIEWER_FEATUREPOINT_SETTING",VIEWER_FEATUREPOINT_ADDING:"VIEWER_FEATUREPOINT_ADDING",VIEWER_FEATUREPOINT_DELETING:"VIEWER_FEATUREPOINT_DELETING",VIEWER_FEATUREPOINT_CLEARING:"VIEWER_FEATUREPOINT_CLEARING",VIEWER_FEATUREPOINT_UPDATING:"VIEWER_FEATUREPOINT_UPDATING",VIEWER_DEPTH_CALCULATING:"VIEWER_DEPTH_CALCULATING",VIEWER_DEPTH_CALCULATED:"VIEWER_DEPTH_CALCULATED",VIEWER_QUALITY_CHANGED:"VIEWER_QUALITY_CHANGED",VIEWER_EFFECT_CHANGED:"VIEWER_EFFECT_CHANGED",VIEWER_BGCOLOR_CHANGED:"VIEWER_BGCOLOR_CHANGED",VIEWER_STEP_CHANGED:"VIEWER_STEP_CHANGED",VIEWER_BRIGHTNESS_CHANGED:"VIEWER_BRIGHTNESS_CHANGED",VIEWER_OPACITY_CHANGED:"VIEWER_OPACITY_CHANGED",VIEWER_HELPER_LAYER_POINT_VISIABLE_CHANGED:"VIEWER_HELPER_LAYER_POINT_VISIABLE_CHANGED",VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED:"VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED",VIEWER_HELPER_LAYER_LINE_TYPE_CHANGED:"VIEWER_HELPER_LAYER_LINE_TYPE_CHANGED",VIEWER_HELPER_LAYER_POINTLINE_VISIABLE_CHANGED:"VIEWER_HELPER_LAYER_POINTLINE_VISIABLE_CHANGED",VIEWER_HELPER_LAYER_LASERPOINT_VISIABLE_CHANGED:"VIEWER_HELPER_LAYER_LASERPOINT_VISIABLE_CHANGED",VIEWER_HELPER_LAYER_RECT_VISIABLE_CHANGED:"VIEWER_HELPER_LAYER_RECT_VISIABLE_CHANGED",VIEWER_OPERATION_DOWN:"VIEWER_OPERATION_DOWN",VIEWER_OPERATION_MOVE:"VIEWER_OPERATION_MOVE",VIEWER_OPERATION_SPECIALMOVE:"VIEWER_OPERATION_SPECIALMOVE",VIEWER_OPERATION_UP:"VIEWER_OPERATION_UP",VIEWER_OPERATION_WHEEL:"VIEWER_OPERATION_WHEEL",VIEWER_MAP_DOWN:"VIEWER_MAP_DOWN",VIEWER_MAP_MOVE:"VIEWER_MAP_MOVE",VIEWER_STEERING_DOWN:"VIEWER_STEERING_DOWN",VIEWER_STEERING_UP:"VIEWER_STEERING_UP",VIEWER_DEACTIVATE_CONTROL:"VIEWER_DEACTIVATE_CONTROL",API_SCENE_CHANGED:"API_SCENE_CHANGED",API_ENTITY_SELECTED:"API_ENTITY_SELECTED",API_ENTITY_CANCEL:"API_ENTITY_CANCEL",API_FEATUREPOINT_HOVER:"API_FEATUREPOINT_HOVER",API_FEATUREPOINT_LEAVE:"API_FEATUREPOINT_LEAVE",API_FEATUREPOINT_CLICKED:"API_FEATUREPOINT_CLICKED",API_STATUS_SYNCHRONIZING:"API_STATUS_SYNCHRONIZING",API_PERMISSION_NONE:"API_PERMISSION_NONE",API_IMAGE_LOADED:"API_IMAGE_LOADED",API_LEVEL_INFO_LOADED:"API_LEVEL_INFO_LOADED"}}.call(this),function(t){"use strict";function e(t){for(var e=null,n=0;t.length>n;n++){var i=t[n];(null===e||i.is3D)&&(e=i.name)}m.defaultSceneName=e,m.activateScene(e)}function n(t){void 0!==t&&(m.entityId=null,m.treeUrl=null,m.toHiddens="",m.hiddens=null,v.emit(y.API_ENTITY_CANCEL),g.onEntityCancel(),g.onTreeNodeCancel(),i(!1),v.emit(y.SPECIAL_EFFECT_IMAGE_UPDATING,{isReady:E}),g.onSceneChanged(t),g.pushDraft(),g.pushMap(),v.emit(y.API_SCENE_CHANGED,{sceneName:t.name,isDefault:t.name===m.defaultSceneName}),g.isRemoteStatus=!1)}function i(t){g.onGeneralWalkSwitched(t,x),w===t||t===!0||(m.computeEyeCenter(),m.resetMap(),g.updateAxis()),w=t,g.pushMap()}function r(t){x=t,m.isMapMode=x,g.onMapSwitched(x),g.pushDraft(),m.resetMap(),g.pushMap()}function o(){null!==L&&(N=!0,clearTimeout(L),L=null)}function a(){if(o(),E){g.setImageStatus(!1);var t=1;switch(""+m.quality){case"80":t=1;break;case"79":t=1.5;break;default:t=2}var e=l(t,null,!1);b=e.substring(0,e.lastIndexOf("&rnd")),_!==b?m.fetchImage(e,function(t,e){var n="";!t&&e&&(n=e.base64Image),g.onDraftImageUpdating(e.base64Image,w,x)}):g.setImageStatus(!0),_=b}}function s(){if(o(),N=!1,E){g.setImageStatus(!1);var e=l(1,0,!0);I=e.substring(0,e.lastIndexOf("&id")),g.isMapDirty&&v.emit(t.Events.CLEARMAP_UPDATING),u(0),g.onClearImageUpdated()}}function u(t){var e=!1,n=l(1,t,!0);T=n.substring(0,n.lastIndexOf("&id")),0===t||t===A?m.fetchImage(n,function(n,i){return null!==n?(o(),void 0):(0===t&&(A=i.id),t=i.id,e=i.isFinished,C=i.base64Image,g.onClearImageUpdating(C,w,x),e?L=null:N?N=!1:L=setTimeout(function(){N||u(t)},10),void 0)}):g.onClearImageUpdating(C,w,x)}function l(t,e,n){var i;if(x){var r=m.mapSize;i=m.buildMapImageUrl(r.width/t,r.height/t,w)}else{var o=m.viewSize;i=m.buildViewImageUrl(o.width/t,o.height/t,e,n)}return i}function c(){if(E&&m.hasMap){var t;if(x){var e=m.viewSize;t=m.buildViewImageUrl(e.width,e.height,0)
}else{var n=m.mapSize;t=m.buildMapImageUrl(n.width,n.height,w)}g.isMapDirty=!1,m.fetchImage(t,function(t,e){g.onMapUpdating(e.base64Image,w,x)})}}function h(){g.initializeParam()}function f(){E&&(g.needDraftSync=!1,g.onWindowResized(),g.pushDraft(),g.resetOffset(),g.updateAxis(),g.needDraftSync=!0)}function d(t){g.isRemoteStatus||(g.isDraftSync=t.isDraftSync,v.emit(y.API_STATUS_SYNCHRONIZING))}function p(t){m.hasMap=t,t&&w&&c()}var m=null,g=null,v=t.emitter,y=t.Events,E=!1,x=!1,w=!1,b=null,_=null,T=null,C=null,I=null,A=null,L=null,N=!1;v.on(y.APP_STARTED,function(){m=t.app.model,g=t.app.mediator}),v.on(y.CAMERA_CHANGED,function(){g.updateAxis()}),v.on(y.SCENES_LOADED,function(t){h(),g.onScenesLoaded(t),g.activateDraftInterval(),E=!0,e(t.scenes),g.onScenesUpdated(),window.isReady=!0}),v.on(y.SCENES_LOADED_ERROR,function(t){g.onScenesLoadError(t)}),v.on(y.LEVEL_INFO_LOADED,function(t){g.onLevelInfoLoaded(),v.emit(y.API_LEVEL_INFO_LOADED,t)}),v.on(y.ACTIVESCENE_CHANGED,n),v.on(y.GENERAL_WALK_SWITCHED,i),v.on(y.MAP_SWITCHED,r),v.on(y.WINDOW_RESIZED,f),v.on(y.DRAFTIMAGE_UPDATING,a),v.on(y.CLEARIMAGE_UPDATING,s),v.on(y.CLEARMAP_UPDATING,c),v.on(y.STATUS_SYNCHRONIZING,d),v.on(y.HAS_MAP_CHANGED,p),v.on(y.IMAGE_LOADED,function(){g.setImageStatus(!0),v.emit(y.API_IMAGE_LOADED)})}(X3),function(){"use strict";function t(){var t=b.highlight;b.highlight=0===t?1:0,_.onHighlightSwitched(b.highlight),_.pushDraft()}function e(){var t=b.gotoEntity();t&&_.pushDraft()}function n(t){b.gotoByPosition(t.position),_.pushDraft()}function i(t){switch(t){case"6":b.view("angle");break;case"5":b.view("bottom");break;case"4":b.view("top");break;case"3":b.view("right");break;case"2":b.view("left");break;case"1":b.view("back");break;case"0":b.view("front");break;default:b.view("front")}_.pushDraft(),_.pushMap()}function r(){b.isRotate=!0}function o(){b.isRotate=!1}function a(){b.zoomIn(),_.pushDraft(),_.pushMap()}function s(){b.zoomOut(),_.pushDraft(),_.pushMap()}function u(){b.zoomFit(),_.pushDraft(),b.isMapMode||_.pushMap()}function l(t){var e=t.start,n=t.end;b.zoomWindow(e.x,e.y,n.x,n.y),_.onZoomWindowSelected(),_.pushDraft()}function c(t){var e=t.lockType,n=null;n=t.isSelected?null:t.axis,b.lockType=e,b.lockAxis=n,"rotate"===e?b.lockRotate(n):b.lockPan(n),_.onAxisLocked(e,n),_.isRemoteStatus||(_.isDraftSync=!1,x.emit(X3.Events.API_STATUS_SYNCHRONIZING))}function h(t){_.needDraftSync=!1,b.quality=t,$.cookie("quality",t,{expires:3e3}),_.pushDraft(),_.needDraftSync=!0}function f(t){var t=parseInt(t);b.effect=t,b.draftEffect=t,0===t&&(b.light=.3),1===t&&(b.light=.6),_.onEffectChanged(t),_.pushDraft()}function d(t){b.setStep(parseFloat(t)+.001)}function p(t){var e=parseInt(255*t,10);b.bgcolor=""+e+","+e+","+e,_.pushDraft()}function m(t){b.light=parseFloat(t)-1,_.pushDraft()}function g(t){9===t?_.onOpacityChanged(!0,b.effect):(_.onOpacityChanged(!1,b.effect),b.effect=0,_.onEffectChanged(b.effect)),b.opacity=t,_.pushDraft()}function v(t){var e="1"===t?!0:!1;b.cameraView.setPerspective(e),_.pushDraft()}function y(t){b.dotDensity=parseFloat(t),_.pushDraft()}function E(t){b.contourWidth=parseFloat(t)+.5,_.pushDraft()}var x=X3.emitter,w=X3.Events,b=null,_=null;x.on(w.APP_STARTED,function(){b=X3.app.model,_=X3.app.mediator}),x.on(w.QUALITY_CHANGED,h),x.on(w.EFFECT_CHANGED,f),x.on(w.STEP_CHANGED,d),x.on(w.BGCOLOR_CHANGED,p),x.on(w.BRIGHTNESS_CHANGED,m),x.on(w.OPACITY_CHANGED,g),x.on(w.ENTITY_GOTO,e),x.on(w.POSITION_GOTO,n),x.on(w.HIGHLIGHT_SWITCHED,t),x.on(w.VIEWPORT_BUTTON_CLICKED,i),x.on(w.ROTATE_BUTTON_CLICKED,r),x.on(w.PAN_BUTTON_CLICKED,o),x.on(w.ZOOMIN_BUTTON_CLICKED,a),x.on(w.ZOOMOUT_BUTTON_CLICKED,s),x.on(w.ZOOMFIT_BUTTON_CLICKED,u),x.on(w.ZOOMWINDOW_SELECTING,l),x.on(w.AXIS_LOCKED,c),x.on(w.PROJECTION_CHANGED,v),x.on(w.DOT_DENSITY_CHANGED,y),x.on(w.CONTOUR_WIDTH_CHANGED,E)}.call(this),function(){"use strict";function t(t){f.selectPivot(t.x,t.y)}function e(t){t.entity&&(f.updatePivot(t.position),d.pushDraft())}function n(){f.updatePivot(),d.isRemoteStatus||(d.isDraftSync=!1,c.emit(X3.Events.API_STATUS_SYNCHRONIZING))}function i(t){f.selectEntity(t.x,t.y)}function r(t){var e=t.entity,n=null==e?null:e.id,i=null==e?null:e.originalId;if("position"===p)c.emit(h.API_ENTITY_SELECTED,{id:n,position:t.position});else if("entity"===p){var r=n!==f.entityId&&null!==n;r?(f.entityId=n,f.gotoBoundingBox=e.boundingBox,c.emit(h.API_ENTITY_SELECTED,{id:n,originalId:i,position:t.position,boundingBox:e.boundingBox,properties:e.properties})):(f.entityId=null,f.gotoBoundingBox=null,c.emit(h.API_ENTITY_CANCEL)),f.originIds=null,f.treeUrl=null,d.onEntitySelected(r,e),d.pushDraft()}}function o(t){var e=t.key,n=t.value;f.getAssociationIds(e,n)}function a(t){for(var e="",n=0;t.length>n;n++)e=e+t[n]+",";f.entityId=e,f.treeUrl=null,d.pushDraft()}function s(){-1===f.toHiddens.indexOf(f.entityId)&&null!==f.entityId&&(f.toHiddens+=f.entityId+","),f.hiddens=""===f.toHiddens?null:f.toHiddens,f.entityId=null,f.treeUrl=null,f.gotoBoundingBox=null,c.emit(h.API_ENTITY_CANCEL),d.onEntityHide(),d.pushDraft()}function u(){f.toHiddens=null!==f.entityId?f.entityId+",":null!==f.treeUrl?f.treeUrl+",":"",f.hiddens=null,d.pushDraft()}function l(){null!==f.entityId&&(f.entityId=null,f.gotoBoundingBox=null,c.emit(h.API_ENTITY_CANCEL),d.onEntityCancel(),d.pushDraft())}var c=X3.emitter,h=X3.Events,f=null,d=null,p="entity";c.on(h.APP_STARTED,function(){f=X3.app.model,d=X3.app.mediator}),c.on(h.SELECTTYPE_CHANGED,function(t){p=t}),c.on(h.PIVOT_SELECTING,t),c.on(h.PIVOT_SELECTED,e),c.on(h.PIVOT_CANCEL,n),c.on(h.ENTITY_SELECTING,i),c.on(h.ENTITY_SELECTED,r),c.on(h.ENTITY_ASSOCIATING,o),c.on(h.ENTITY_ASSOCIATED,a),c.on(h.ENTITY_HIDE,s),c.on(h.ENTITY_HIDE_CANCEL,u),c.on(h.ENTITY_CANCEL,l)}.call(this),function(){"use strict";function t(t){var e=t.start,n=t.end;c.sectionByLine(e.x,e.y,n.x,n.y);var i=c.sectionPercentage();h.onCutCustomerSelected(i),h.pushDraft()}function e(t){c.selectCutPoint(t.x,t.y)}function n(t){if(t.entity){c.sectionByPoint(t.position,t.normal);var e=c.sectionPercentage();h.onCutCustomerSelected(e),h.pushDraft()}}function i(t){c.sectionByAxis(t),h.onCutAxisSelected(t,50),h.pushDraft()}function r(t){c.toggleSectionReverse();var e=c.sectionPercentage();h.onCutRedirectChanged(t,e),h.pushDraft()}function o(t){c.sectionPercentage(t),h.pushDraft()}function a(t){h.onCutSpecialMode(t),c.sectionSpecialMode(t),h.pushDraft()}function s(){h.onCutCanceled(50),0!==c.sectionMode&&(c.cancelSection(),h.pushDraft())}var u=X3.emitter,l=X3.Events,c=null,h=null;u.on(l.APP_STARTED,function(){c=X3.app.model,h=X3.app.mediator}),u.on(l.CUT_AXIS,i),u.on(l.CUT_POINT_SELECTING,e),u.on(l.CUT_POINT_SELECTED,n),u.on(l.CUT_LINE,t),u.on(l.CUT_DIRECTION_CHANGED,r),u.on(l.CUT_RANGE_CHANGED,o),u.on(l.CUT_CANCEL,s),u.on(l.CUT_SPECIAL_MODE,a)}.call(this),function(t){"use strict";X3.SvgAxisFrame=function(e,n,i){function r(t){null!=f.showedCircle&&f.showedCircle.attr({opacity:0}),null===t?f.showedCircle=null:(f.showedCircle=t,f.showedCircle.attr({opacity:1}))}function o(t){null!=f.highlightLine&&f.highlightLine.attr({"stroke-width":2}),null===t?f.highlightLine=null:(f.highlightLine=t,f.highlightLine.attr({"stroke-width":6}))}function a(t,e,n){var i=l(e,n);t.attr("path",i)}function s(t,e){t.attr({x:e.x,y:e.y})}function u(t,e){t.attr({cx:e.x,cy:e.y})}function l(e,n){var i=t.format("M{0},{1}L{2},{3}",e.x,e.y,n.x,n.y);return i}function c(){f.xAxisPoint=h(f.xAxis,f.axisLength),f.yAxisPoint=h(f.yAxis,f.axisLength),f.zAxisPoint=h(f.zAxis,f.axisLength),f.xTextPoint=h(f.xAxis,f.textLength),f.yTextPoint=h(f.yAxis,f.textLength),f.zTextPoint=h(f.zAxis,f.textLength),f.originPoint.x=f.offsetX,f.originPoint.y=f.height-f.offsetY}function h(t,e){t=t.clone();var n=t.x-f.originPoint.x,i=t.y-f.originPoint.y;return t.x=f.offsetX+n*e,t.y=f.height-f.offsetY+i*e,t}var f={};return f.width=n,f.height=i,f.xAxis=null,f.yAxis=null,f.zAxis=null,f.originPoint=null,f.paper=new t(e,n,i),f.xLine=f.paper.path(""),f.yLine=f.paper.path(""),f.zLine=f.paper.path(""),f.xText=f.paper.text(0,0,"X"),f.yText=f.paper.text(0,0,"Y"),f.zText=f.paper.text(0,0,"Z"),f.xRotateCircle=f.paper.circle(0,0,5),f.yRotateCircle=f.paper.circle(0,0,5),f.zRotateCircle=f.paper.circle(0,0,5),f.xAxisPoint=null,f.yAxisPoint=null,f.zAxisPoint=null,f.xTextPoint=null,f.yTextPoint=null,f.zTextPoint=null,f.offsetX=50,f.offsetY=50,f.axisLength=35,f.textLength=45,f.highlightLine=null,f.showedCircle=null,f.xLine.attr({stroke:"#f00","stroke-width":2,"stroke-linecap":"round"}),f.yLine.attr({stroke:"#0f0","stroke-width":2,"stroke-linecap":"round"}),f.zLine.attr({stroke:"#00f","stroke-width":2,"stroke-linecap":"round"}),f.xRotateCircle.attr({stroke:"#f00",fill:"#f00",opacity:0}),f.yRotateCircle.attr({stroke:"#0f0",fill:"#0f0",opacity:0}),f.zRotateCircle.attr({stroke:"#00f",fill:"#00f",opacity:0}),f.draw=function(){c(),a(f.xLine,f.originPoint,f.xAxisPoint),a(f.yLine,f.originPoint,f.yAxisPoint),a(f.zLine,f.originPoint,f.zAxisPoint),s(f.xText,f.xTextPoint),s(f.yText,f.yTextPoint),s(f.zText,f.zTextPoint),u(f.xRotateCircle,f.xAxisPoint),u(f.yRotateCircle,f.yAxisPoint),u(f.zRotateCircle,f.zAxisPoint)},f.resize=function(t,e){f.width=t,f.height=e,f.paper.setSize(t,e)},f.origin=function(t,e){t&&e?(f.offsetX=t,f.offsetY=f.height-e):(f.offsetX=50,f.offsetY=50)},f.highlightAxisLine=function(t){"x"===t?o(f.xLine):"y"===t?o(f.yLine):"z"===t?o(f.zLine):o(null)},f.showAxisCircle=function(t){"x"===t?r(f.xRotateCircle):"y"===t?r(f.yRotateCircle):"z"===t?r(f.zRotateCircle):r(null)},{draw:f.draw,origin:f.origin,resize:f.resize,showAxisCircle:f.showAxisCircle,highlightAxisLine:f.highlightAxisLine,xAxis:function(t){return t?(f.xAxis=t,void 0):f.xAxis},yAxis:function(t){return t?(f.yAxis=t,void 0):f.yAxis},zAxis:function(t){return t?(f.zAxis=t,void 0):f.zAxis},originPoint:function(t){return t?(f.originPoint=t,void 0):f.originPoint}}}}(window.Raphael),function(t){"use strict";X3.SvgHelperLineFrame=function(e,n,i){var r={};return r.paper=new t(e[0],n,i),e.children("div").css("position","absolute"),r.resize=function(t,e){r.paper.setSize(t,e)},r.draw=function(t,e,n){r.clear();var i="M"+t.x+" "+t.y+"L"+e.x+" "+e.y,o=r.paper.path(i);if(n){var a=r.paper.circle(0,0,3),s=r.paper.circle(0,0,3);a.attr({cx:t.x,cy:t.y,stroke:"yellow",fill:"yellow"}),s.attr({cx:e.x,cy:e.y,stroke:"yellow",fill:"yellow"})}o.attr({stroke:"red","stroke-width":2,"stroke-linecap":"round"})},r.drawPointLine=function(t,e,n){void 0===n&&(n="red");var i="M"+t.x+" "+t.y+"L"+e.x+" "+e.y,o=r.paper.path(i);o.attr({stroke:n,"stroke-width":2,"stroke-linecap":"round"})},r.clear=function(){r.paper.clear()},{draw:r.draw,drawPointLine:r.drawPointLine,clear:r.clear,resize:r.resize}}}(window.Raphael),function(t,e){t.effects={effect:{}},function(){function n(e){var n,i,r=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(r&&r.length&&r[0]&&r[r[0]])for(i=r.length;i--;)n=r[i],"string"==typeof r[n]&&(o[t.camelCase(n)]=r[n]);else for(n in r)"string"==typeof r[n]&&(o[n]=r[n]);return o}function i(e,n){var i,r,a={};for(i in n)r=n[i],e[i]!==r&&(o[i]||(t.fx.step[i]||!isNaN(parseFloat(r)))&&(a[i]=r));return a}var r=["add","remove","toggle"],o={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,n){t.fx.step[n]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(jQuery.style(t.elem,n,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(e,o,a,s){var u=t.speed(o,a,s);return this.queue(function(){var o,a=t(this),s=a.attr("class")||"",l=u.children?a.find("*").addBack():a;l=l.map(function(){var e=t(this);return{el:e,start:n(this)}}),o=function(){t.each(r,function(t,n){e[n]&&a[n+"Class"](e[n])})},o(),l=l.map(function(){return this.end=n(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",s),l=l.map(function(){var e=this,n=t.Deferred(),i=t.extend({},u,{queue:!1,complete:function(){n.resolve(e)}});return this.el.animate(this.diff,i),n.promise()}),t.when.apply(t,l.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),u.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(n,i,r,o){return i?t.effects.animateClass.call(this,{add:n},i,r,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(n,i,r,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:n},i,r,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(n){return function(i,r,o,a,s){return"boolean"==typeof r||r===e?o?t.effects.animateClass.call(this,r?{add:i}:{remove:i},o,a,s):n.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},r,o,a)}}(t.fn.toggleClass),switchClass:function(e,n,i,r,o){return t.effects.animateClass.call(this,{add:n,remove:e},i,r,o)}})}()}(jQuery);var NewUISlider=function(t,e){"use strict";function n(){for(var t=l.find(".new-ui-slider-bar")[0],e=t,n=t.offsetLeft,i=t.offsetTop;e=e.offsetParent;)n+=e.offsetLeft,i+=e.offsetTop;var r={};return r.x=n,r.y=i,r}function i(t){0-r/2>t?t=0-r/2:t>s&&(t=s),w.css({left:t}),m&&b.css({width:t+r/2}),d=(t+r/2)/p*(h+c),c>d?d=c:d>h&&(d=h),u.change()}var r,o,a,s,u=this,l=t,c=null===e.minValue?0:e.minValue,h=null===e.maxValue?100:e.maxValue,f=null===e.initValue?0:e.initValue,d=f,p=null===e.length?100:e.length,m=null===e.isFill?!1:e.isFill,g={},v=1,y=!1,E=null,x=null,w=$("<div>");w.addClass("new-ui-slider-cursor");var b=$("<div>");b.addClass("new-ui-slider-fill");var _=$("<div>");_.addClass("new-ui-slider-bar");var T=$("<div>");T.addClass("new-ui-slider"),_.append(b),_.append(w),T.append(_),l.append(T),r=w.width(),o=w.height(),a=_.height(),s=p-r/2,_.css({width:p,borderRadius:a,top:(o-a)/2}),x=f/(c+h)*p-r/2,w.css({top:(a-o)/2-v,left:x}),m&&(b.show(),b.css({width:x+r/2,height:a,borderRadius:a})),T.css({height:o+2*v,paddingTop:(l.height()-(o+2*v))/2}),u.change=function(t){t?g.change=t:g.change&&g.change(d)},u.setValue=function(t,e){x=t/(c+h)*p-r/2,0-r/2>x?x=0-r/2:x>s&&(x=s),w.css({left:x}),m&&b.css({width:x+r/2}),d=(x+r/2)/p*(h+c),c>d?d=c:d>h&&(d=h),0!=e&&u.change()},u.getValue=function(){return d},w.mousedown(function(t){t.preventDefault(),t.stopPropagation(),1===t.which&&(y=!0,E=t.clientX)}),w.mousemove(function(t){if(y){t.preventDefault(),t.stopPropagation();var e=n(),o=t.clientX-e.x;x=o-r/2,i(x),E=t.clientX}}),w.mouseup(function(t){y&&(t.preventDefault(),t.stopPropagation(),y=!1,E=null)}),_.mousedown(function(t){if(t.preventDefault(),t.stopPropagation(),1===t.which){y=!0;var e=n(),o=t.clientX-e.x;x=o-r/2,i(x),E=t.clientX}}),$(document).mousemove(function(t){if(y){var e=t.clientX-E;x+=e,i(x),E=t.clientX}}),$(document).mouseup(function(){y&&(y=!1,E=null)}),w.bind("touchstart",function(t){var e=t.originalEvent;e.preventDefault(),e.stopPropagation();var n=e.targetTouches;1===n.length&&(y=!0,E=e.clientX)}),w.bind("touchmove",function(t){var e=t.originalEvent;e.preventDefault(),e.stopPropagation();var o=e.targetTouches;if(1===o.length&&y){var a=o[0],s=n(),u=a.clientX-s.x;x=u-r/2,i(x),E=a.clientX}}),w.bind("touchend",function(t){var e=t.originalEvent;e.preventDefault(),e.stopPropagation(),y&&(y=!1,E=null)}),_.bind("touchstart",function(t){var e=t.originalEvent;e.preventDefault(),e.stopPropagation();var o=e.targetTouches;if(1===o.length){var a=o[0];y=!0;var s=n(),u=a.clientX-s.x;x=u-r/2,i(x),E=a.clientX}}),$(document).bind("touchmove",function(t){var e=t.originalEvent,n=e.targetTouches;if(1===n.length&&y){var r=n[0],o=r.clientX-E;x+=o,i(x),E=r.clientX}}),$(document).bind("touchend",function(){y&&(y=!1,E=null)})};$(function(){"use strict";var t=$(".slider"),e={};t.each(function(){var t=$(this),n=t.attr("id"),i={initValue:parseFloat(t.attr("data-initValue")),minValue:parseFloat(t.attr("data-minValue")),maxValue:parseFloat(t.attr("data-maxValue")),length:t.width()-20,isFill:!0},r=new NewUISlider(t,i);e[n]=r}),jQuery.extend({newUISlider:function(t){return e[t]}})});var X3UIDialog=function(t){"use strict";function e(t){n.$dialogLayer.hasClass("dialog-dynamic")&&(n.$dialogLayer.css({width:n.$dialog.width(),height:n.$dialog.height()}),t||n.$dialogLayer.css({top:n.$dialog.css("top"),left:n.$dialog.css("left")}),n.$dialog.css({top:0,left:0}))}var n={};return n.isAutoSize=!1,n.isAutoPosition=!1,n.maxMobileWidth=568,n.minMobileWidth=320,n.id=t,n.$dialogLayer=$("#"+t),n.$dialog=n.$dialogLayer.find(".dialog"),n.$dialogHeader=n.$dialog.find(".dialog-header"),n.$dialogBody=n.$dialog.find(".dialog-body"),n.$closeDialogBtn=n.$dialogLayer.find(".dialog-close"),n.$2xDialogBtn=n.$dialogLayer.find(".dialog-2x"),n.$1xDialogBtn=n.$dialogLayer.find(".dialog-1x"),n.defaultWidth=0,n.defaultHeight=0,n.originWidth=null,n.originHeight=null,n.originLeft=n.$dialog.css("left"),n.originTop=n.$dialog.css("top"),n.isResizeLocked=!1,0===n.$dialog.width()||0===n.$dialog.height()?n.isAutoSize=!0:(n.originWidth=n.$dialog.width(),n.originHeight=n.$dialog.height()),n.show=function(){$(window).width()>n.maxMobileWidth?(n.$1xDialogBtn.hide(),n.$2xDialogBtn.show(),n.isAutoSize?(n.defaultWidth=.3*$(window).width(),n.defaultHeight=.4*$(window).height(),n.$dialog.css({width:.3*$(window).width(),height:.4*$(window).height(),top:"auto"===n.originTop?.3*$(window).height():n.originTop,left:"auto"===n.originLeft?.35*$(window).width():n.originLeft})):(n.defaultWidth=n.originWidth,n.defaultHeight=n.originHeight,n.$dialog.css({width:n.originWidth,height:n.originHeight,top:"auto"===n.originTop?($(window).height()-n.$dialog.height())/2:n.originTop,left:"auto"===n.originLeft?($(window).width()-n.$dialog.width())/2:n.originLeft}),n.$dialog.width()>$(window).width()&&n.$dialog.css({width:$(window).width(),left:0}),n.$dialog.height()>$(window).height()&&n.$dialog.css({height:$(window).height(),top:0})),null===n.$dialog.find(".dialog-header").height()?n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()}):n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()-n.$dialog.find(".dialog-header").height()-1})):(n.$1xDialogBtn.hide(),n.$2xDialogBtn.hide(),n.$dialog.css({width:$(window).width(),height:$(window).height(),top:0,left:0}),null===n.$dialog.find(".dialog-header").height()?n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()}):n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()-n.$dialog.find(".dialog-header").height()-1})),e(!1),n.$dialogLayer.show()},n.$closeDialogBtn.click(function(){n.$dialogLayer.hide()}),n.$1xDialogBtn.click(function(){n.$1xDialogBtn.hide(),n.$2xDialogBtn.show(),n.$dialog.css({width:n.defaultWidth,height:n.defaultHeight}),null===n.$dialog.find(".dialog-header").height()?n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()}):n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()-n.$dialog.find(".dialog-header").height()-1}),e(!0)}),n.$2xDialogBtn.click(function(){n.$1xDialogBtn.show(),n.$2xDialogBtn.hide(),n.$dialog.css({width:2*n.defaultWidth,height:2*n.defaultHeight}),null===n.$dialog.find(".dialog-header").height()?n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()}):n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()-n.$dialog.find(".dialog-header").height()-1}),e(!0)}),$(window).resize(function(){n.isResizeLocked||($(window).width()>n.maxMobileWidth?(n.$1xDialogBtn.hide(),n.$2xDialogBtn.show(),n.isAutoSize?(n.defaultWidth=.3*$(window).width(),n.defaultHeight=.3*$(window).height(),n.$dialog.css({width:.3*$(window).width(),height:.4*$(window).height(),top:"auto"===n.originTop?.3*$(window).height():n.originTop,left:"auto"===n.originLeft?.35*$(window).width():n.originLeft})):(n.defaultWidth=n.originWidth,n.defaultHeight=n.originHeight,n.$dialog.css({width:n.originWidth,height:n.originHeight,top:"auto"===n.originTop?($(window).height()-n.$dialog.height())/2:n.originTop,left:"auto"===n.originLeft?($(window).width()-n.$dialog.width())/2:n.originLeft}),n.$dialog.width()>$(window).width()&&n.$dialog.css({width:$(window).width(),left:0}),n.$dialog.height()>$(window).height()&&n.$dialog.css({height:$(window).height(),top:0})),null===n.$dialog.find(".dialog-header").height()?n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()}):n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()-n.$dialog.find(".dialog-header").height()-1})):(n.$1xDialogBtn.hide(),n.$2xDialogBtn.hide(),n.$dialog.css({width:$(window).width(),height:$(window).height(),top:0,left:0}),null===n.$dialog.find(".dialog-header").height()?n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()}):n.$dialog.find(".dialog-body").css({width:n.$dialog.width(),height:n.$dialog.height()-n.$dialog.find(".dialog-header").height()-1})),e(!1))}),n.$dialogLayer.hasClass("dialog-dynamic")&&(n.isHeaderDown=!1,n.lastX=null,n.lastY=null,n.$dialogHeader.mousedown(function(t){1===t.which&&(t.preventDefault(),t.stopPropagation(),n.isHeaderDown=!0,n.isResizeLocked=!0,n.lastX=t.clientX,n.lastY=t.clientY)}),n.$dialogHeader.mousemove(function(t){if(n.isHeaderDown&&1===t.which){t.preventDefault(),t.stopPropagation();var e=t.clientX-n.lastX,i=t.clientY-n.lastY,r=n.$dialogLayer.offset().top+i,o=n.$dialogLayer.offset().left+e;n.$dialogLayer.css({top:r,left:o}),n.lastX=t.clientX,n.lastY=t.clientY}}),n.$dialogHeader.mouseup(function(t){n.isHeaderDown&&1===t.which&&(t.preventDefault(),t.stopPropagation(),n.isHeaderDown=!1,n.isResizeLocked=!1,n.lastX=null,n.lastY=null)}),n.$dialogHeader.bind("touchstart",function(t){var e=t.originalEvent;e.stopPropagation();var i=e.targetTouches,r=i[0];n.isHeaderDown=!0,n.isResizeLocked=!0,n.lastX=r.clientX,n.lastY=r.clientY}),n.$dialogHeader.bind("touchmove",function(t){if(n.isHeaderDown){var e=t.originalEvent;e.preventDefault(),e.stopPropagation();var i=e.targetTouches,r=i[0],o=r.clientX-n.lastX,a=r.clientY-n.lastY,s=n.$dialogLayer.offset().top+a,u=n.$dialogLayer.offset().left+o;n.$dialogLayer.css({top:s,left:u}),n.lastX=r.clientX,n.lastY=r.clientY}}),n.$dialogHeader.bind("touchend",function(t){if(n.isHeaderDown){var e=t.originalEvent;e.stopPropagation(),n.isHeaderDown=!1,n.isResizeLocked=!1,n.lastX=null,n.lastY=null}}),$(document).mousemove(function(t){if(n.isHeaderDown){var e=t.clientX-n.lastX,i=t.clientY-n.lastY,r=n.$dialogLayer.offset().top+i,o=n.$dialogLayer.offset().left+e;n.$dialogLayer.css({top:r,left:o}),n.lastX=t.clientX,n.lastY=t.clientY}}),$(document).mouseup(function(){n.isHeaderDown&&(n.isHeaderDown=!1,n.isResizeLocked=!1,n.lastX=null,n.lastY=null)})),{show:function(){n.show()},hide:function(){n.$dialogLayer.hide()}}};$(function(){"use strict";var t=$("a"),e=$(".dialog-container"),n={};e.each(function(){var t=$(this).attr("id"),e=new X3UIDialog(t);n[t]=e}),t.click(function(){var t=$(this).attr("data-dialog");null!=t&&n[t].show()}),jQuery.extend({x3uiDialog:function(t){return n[t]}})}),function(t){"use strict";function e(){var t=l.getScreenRadioSize();c.updateViewSize(t.width,t.height)}function n(){e()}function i(t){l.showErrorMessage(t.status)}function r(){l.activeImageErrorEvent()}function o(t){var e=t.scene;e.is3D?(c.view("angle"),l.show3dButtons()):l.show2dButtons()}function a(t){l.updateImage(t.base64Image)}function s(t){l.updateImage(t.base64Image)}function u(){if(l.axisFrame){var e=c.modelToAxisScreen(new t.Vector3(1,0,0)),n=c.modelToAxisScreen(new t.Vector3(0,1,0)),i=c.modelToAxisScreen(new t.Vector3(0,0,1)),r=c.modelToAxisScreen(new t.Vector3(0,0,0));l.axisFrame.xAxis(e),l.axisFrame.yAxis(n),l.axisFrame.zAxis(i),l.axisFrame.originPoint(r),l.axisFrame.draw()}}var l=null,c=null,h=null,f=t.emitter,d=t.Events;f.on(d.APP_STARTED,function(){c=t.app.model,h=t.app.mediator,l=t.app.view,c.quality=79,c.highlight=0,c.light=.3,c.bgTexture=1,c.contourWidth=.5,c.dotDensity=.5}),f.on(d.VIEWER_PARAM_INITIALIZE,e),f.on(d.VIEWER_WINDOW_RESIZED,n),f.on(d.VIEWER_SCENES_LOADED_ERROR,i),f.on(d.VIEWER_SCENES_UPDATED,r),f.on(d.VIEWER_ACTIVESCENE_CHANGED,o),f.on(d.VIEWER_AXIS_UPDATING,u),f.on(d.VIEWER_DRAFT_UPDATING,a),f.on(d.VIEWER_CLEAR_UPDATING,s)}(X3),function(){"use strict";function t(){function t(t,e){var n=r.$activeImage,i=n.css("left"),o=n.css("top"),a=parseInt(i.substring(0,i.lastIndexOf("px")),10),s=parseInt(o.substring(0,o.lastIndexOf("px")),10);n.css({left:a+t,top:s+e})}function e(t){var e=r.$activeImage,n=r.width,i=r.height;a*=t;var s=n*a+.5,u=i*a+.5,l=s-n,c=u-i,h=e.css("left"),f=e.css("top"),d=0,p=0;o&&(d=parseInt(h.substring(0,h.lastIndexOf("px")),10),p=parseInt(f.substring(0,f.lastIndexOf("px")),10),l=s-e.width(),c=u-e.height()),e.css({left:d-l/2,top:p-c/2,width:s,height:u})}var n=X3.app.model,i=X3.app.mediator,r=X3.app.view,o=!1,a=1;this.resetDelta=function(){a=1},this.down=function(t){(1===t.button||2===t.button||1===t.fingerCount||2===t.fingerCount)&&r.hideAllDropdown()},this.move=function(e){if(1===e.button||2===e.button||1===e.fingerCount||2===e.fingerCount){r.setScreenCursor("pan"),o=!0;var i=e.to.x-e.from.x,a=e.to.y-e.from.y;t(i,a),n.pan(e.from.x,e.from.y,e.to.x,e.to.y)}},this.up=function(t){(1===t.button||2===t.button||1===t.fingerCount||2===t.fingerCount)&&(o=!1,i.pushDraft())},this.wheel=function(t){var r=t.delta>0?1.1:.8887;e(r),t.delta>0?n.zoomIn():n.zoomOut(),i.pushDraft()}}function e(){var t=X3.app.model,e=X3.app.mediator,n=X3.app.view;this.down=function(t){(1===t.button||2===t.button||1===t.fingerCount||2===t.fingerCount)&&n.hideAllDropdown()},this.move=function(i){1===i.button||1===i.fingerCount?("pan"===t.lockType&&null!=t.lockAxis?(n.setScreenCursor("pan"),t.pan(i.from.x,i.from.y,i.to.x,i.to.y)):(n.setScreenCursor("rotate"),t.rotate(i.from.x,i.from.y,i.to.x,i.to.y)),e.pushDraft()):(2===i.button||2===i.fingerCount)&&(n.setScreenCursor("pan"),t.pan(i.from.x,i.from.y,i.to.x,i.to.y),e.pushDraft())},this.up=function(i){if(1===i.button||2===i.button||1===i.fingerCount||2===i.fingerCount){if(null!=t.lockType&&null!=t.lockAxis&&o.emit(a.AXIS_LOCKED,{lockType:t.lockType,axis:t.lockAxis}),1==i.button||1==i.fingerCount){var r=Math.abs(i.start.x-i.end.x),s=Math.abs(i.start.y-i.end.y);n.isMobile&&30>r+s?e.onEntitySelecting(i.start):15>r+s&&e.onEntitySelecting(i.start)}n.setScreenCursor("default"),i.button=null,i.fingerCount=null}},this.wheel=function(n){n.delta>0?t.zoomIn():t.zoomOut(),e.pushDraft()}}function n(){var t=X3.app.view;this.move=function(e){(1===e.button||1===e.fingerCount)&&t.setHelperRect(e.start,e.end)},this.up=function(t){(1===t.button||1===t.fingerCount)&&(p.onZoomWindowSelecting(t.start,t.end),t.button=null,t.fingerCount=null)}}function i(){var t=X3.app.view;this.down=function(){},this.move=function(e){(1===e.button||1===e.fingerCount)&&t.setHelperLine(e.start,e.end)},this.up=function(t){if(1===t.button||1===t.fingerCount){var e=t.start,n=t.end,i=Math.abs(n.x-e.x),r=Math.abs(n.y-e.y);if(10>i+r){var o=(e.x+n.x)/2,a=(e.y+n.y)/2;p.onCutPointSelecting(o,a)}else p.onCutLineSelecting(e,n);t.button=null,t.fingerCount=null}}}function r(){this.down=function(t){(1===t.button||1===t.fingerCount)&&(m.hideAllDropdown(),p.onPivotSelecting(t.point))}}var o=X3.emitter,a=X3.Events,s=!0,u=null,l=null,c=null,h=null,f=null,d=null,p=null,m=null;o.on(a.APP_STARTED,function(){p=X3.app.mediator,m=X3.app.view,p.init({operateLayer:m.$operateLayer,selectPointLayer:m.$selectPointLayer,drawLineLayer:m.$selectLineLayer,selectRectangeLayer:m.$selectRectangeLayer,getOffset:m.getOffset})}),o.on(a.VIEWER_SCENES_LOADED,function(){l=new e,c=new t,h=new n,f=new i,d=new r}),o.on(a.VIEWER_ACTIVESCENE_CHANGED,function(t){s=t.scene.is3D,u=t.scene.is3D?l:c}),o.on(a.VIEWER_HELPER_LAYER_RECT_VISIABLE_CHANGED,function(t){u=t?h:c}),o.on(a.VIEWER_HELPER_LAYER_LINE_VISIABLE_CHANGED,function(t){u=t?f:l}),o.on(a.VIEWER_HELPER_LAYER_POINT_VISIABLE_CHANGED,function(t){u=t?d:l}),o.on(a.VIEWER_OPERATION_DOWN,function(t){u.down(t)}),o.on(a.VIEWER_OPERATION_MOVE,function(t){u.move(t)}),o.on(a.VIEWER_OPERATION_UP,function(t){u.up(t)}),o.on(a.VIEWER_OPERATION_WHEEL,function(t){u.wheel(t)}),o.on(a.VIEWER_CLEARIMAGE_UPDATED,function(){u&&u.resetDelta&&u.resetDelta()})}.call(this),function(t){"use strict";function e(){}function n(){o.hideAllDropdown(),o.$menuBtnZoomwindow.removeClass("menu-btn-active")}function i(t){a.draftEffect=t.effect,"0"===t.effect&&(a.light=.3),"1"===t.effect&&(a.light=.6)}function r(t){o.fillDistanceInfo(t.distance,t.dx,t.dy,t.dz,t.start2d,t.end2d)}var o=null,a=null,s=null,u=t.emitter,l=t.Events;u.on(l.APP_STARTED,function(){a=t.app.model,s=t.app.mediator,o=t.app.view,e()}),u.on(l.VIEWER_ZOOMWINDOW_SELECTED,n),u.on(l.VIEWER_DISTANCE_CALCULATED,r),u.on(l.VIEWER_EFFECT_CHANGED,i)}(X3),function(){"use strict";function t(){r.activateCancelCutButton(null)}function e(){}var n=X3.emitter,i=X3.Events,r=null;n.on(i.APP_STARTED,function(){r=X3.app.view}),n.on(i.VIEWER_CUT_CUSTOMER,t),n.on(i.VIEWER_CUT_CANCEL,e)}.call(this),function(){"use strict";function t(t){var e=t.isEntitySelected,n=t.entity;if(e){if(n.boundingBox){var i=new X3.Box3;i.min=new X3.Vector3(n.boundingBox.minX,n.boundingBox.minY,n.boundingBox.minZ),i.max=new X3.Vector3(n.boundingBox.maxX,n.boundingBox.maxY,n.boundingBox.maxZ),o.pivot=i.center()}}else o.pivot=null}function e(){o.pivot=null}function n(){o.pivot=null}var i=X3.emitter,r=X3.Events,o=null,a=null,s=null;i.on(r.APP_STARTED,function(){o=X3.app.model,a=X3.app.mediator,s=X3.app.view}),i.on(r.VIEWER_ENTITY_SELECTED,t),i.on(r.VIEWER_ENTITY_CANCEL,e),i.on(r.VIEWER_ENTITY_HIDE,n)}.call(this),function(t){"use strict";window.Menu=function(){function e(t){if(1===t.which){if(t.preventDefault(),t.stopPropagation(),f.hasClass("menu-control-active")&&P())return;g=!0,v=!1,E=t.clientX,x=t.clientY,w&&clearInterval(w),w=setInterval(function(){b=!0},10)}}function n(e){if(g&&1===e.which){e.preventDefault(),e.stopPropagation();var n=e.clientX-E,i=e.clientY-x;if(20>Math.abs(n)&&20>Math.abs(i))return;if(v=!0,!b)return;b=!1;var r=l.position().top+i,o=t(window).width()-l.position().left-l.width()-n;l.css({top:r,right:o}),E=e.clientX,x=e.clientY}}function i(t){g&&1===t.which&&(t.preventDefault(),t.stopPropagation(),clearInterval(w),v&&N(),g=!1,E=null,x=null,b=!1)}function r(t){var e=t.originalEvent;if(e.stopPropagation(),!f.hasClass("menu-control-active")||!P()){var n=e.targetTouches,i=n[0];g=!0,v=!1,E=i.clientX,x=i.clientY,w&&clearInterval(w),w=setInterval(function(){b=!0},10)}}function o(e){if(g){var n=e.originalEvent;n.preventDefault(),n.stopPropagation();var i=n.targetTouches,r=i[0],o=r.clientX-E,a=r.clientY-x;if(20>Math.abs(o)&&20>Math.abs(a))return;if(v=!0,!b)return;b=!1;var s=l.position().top+a,u=t(window).width()-l.position().left-l.width()-o;l.css({top:s,right:u}),E=r.clientX,x=r.clientY}}function a(t){if(g){var e=t.originalEvent;e.stopPropagation(),clearInterval(w),v&&N(),g=!1,E=null,x=null,b=!1}}var s=this,u=null,l=t("#div-menu-layer"),c=l.find("#menu-pad"),h=l.find(".menu-btn"),f=l.find("#menu-control");l.find("#menu-btn-home"),l.find("#menu-btn-section"),l.find("#menu-btn-qrcode"),l.find("#menu-btn-special-effect"),l.find("#menu-btn-zoomfit"),l.find("#menu-btn-zoomwindow");var d=t(".assist"),p=320,m=568,g=!1,v=!1,y={top:l.position().top,right:t(window).width()-l.position().left-l.width()},E=null,x=null,w=null,b=!0;s.setView=function(t){u=t};var _=function(){d.hide()},T=function(e){t("#"+e).show()},C=function(t){t.addClass("menu-btn-active")},I=function(t){t.removeClass("menu-btn-active")},A=function(e){var n=0,i=t(window).height()-l.height();f.hasClass("menu-control-active")&&(n=72,i-=72);var r=e;return D()||(n=(f.height()-l.height())/2+10,i=t(window).height()-(l.height()+f.height())/2-10),n>e&&(r=n),e>i&&(r=i),r},L=function(e){var n=0,i=t(window).width()-l.width();f.hasClass("menu-control-active")&&(n=72,i-=72);var r=e;return D()||(n=(f.width()-l.width())/2+10,i=t(window).width()-(l.width()+f.width())/2-10),n>e&&(r=n),e>i&&(r=i),r
},N=function(){var e=A(l.position().top),n=L(t(window).width()-l.position().left-l.width());l.animate({top:e,right:n},100),y.top=e,y.right=n},S=function(){return P()?(f.hasClass("menu-control-active")?l.animate({top:(u.height-l.height())/2,right:(u.width-l.width())/2},50):l.animate({top:y.top,right:y.right},50),void 0):(l.removeClass("hide"),N(),void 0)},P=function(){var t=null!=u?u.mobileMaxWidth:m,e=null!=u?u.mobileMinWidth:p;return u&&t>=u.width&&u.width>=e?!0:!1},D=function(){return f.hasClass("menu-control-active")};f.on("click",function(){v||(t(this).hasClass("menu-control-active")?(f.removeClass("menu-control-active"),h.removeClass("open",100),c.removeClass("open",100),l.removeClass("menu-opacity-half")):(f.addClass("menu-control-active"),c.addClass("open",200),h.delay(100).addClass("expanding",100).switchClass("expanding","open",200)),S())}),h.on("click",function(){if(!v&&!t(this).hasClass("menu-btn-disabled")){if(t(this).hasClass("menu-btn-active"))_(),I(t(this));else{_();var e=t(this).attr("data-assist");null!=e&&(T(e),C(t(this)))}P()&&"menu-btn-special-effect"!==t(this).attr("id")&&f.click()}}),t(window).on("resize",function(){S()}),l.on("mousedown",e),l.on("mousemove",n),l.on("mouseup",i),t(document).on("mouseup",i),l.on("touchstart",r),l.on("touchmove",o),l.on("touchend",a),t(document).on("touchend",i)}}(jQuery),function(t,e){"use strict";X3.View=function(n,i,r,o){var a=this;a.isMobile=!1,a.mobileMinWidth=320,a.mobileMaxWidth=568,a.callbacks={},a.emit=X3.emitter.emit,a.Events=X3.Events,a.$frameLayer=t("#"+n),a.$viewLayer=a.$frameLayer.find("#div-view"),a.$menuLayer=a.$frameLayer.find("#div-menu-layer"),a.$menuLi=a.$menuLayer.find(".menu-bar > li"),a.$assistLayer=t(".assist"),a.$menuBtnZoomfit=a.$menuLayer.find("#menu-btn-zoomfit"),a.$menuBtnZoomwindow=a.$menuLayer.find("#menu-btn-zoomwindow"),a.$viewportBtn=a.$menuLayer.find("#menu-btn-home"),a.$sectionBtn=a.$menuLayer.find("#menu-btn-section"),a.$specialEffectBtn=a.$menuLayer.find("#menu-btn-special-effect"),a.$selectPointLayer=a.$viewLayer.find("#div-selectpoint"),a.$selectLineLayer=a.$viewLayer.find("#div-selectline"),a.$selectRectangeLayer=a.$viewLayer.find("#div-selectrectange"),a.$rectangeSelector=a.$selectRectangeLayer.find("#div-rectange"),a.$imageLayer=a.$viewLayer.find("#div-image"),a.$operateLayer=a.$imageLayer.find("#div-screen-image"),a.$svgLayer=a.$imageLayer.find("#div-svg"),a.$axisFrameCanvas=a.$imageLayer.find("#canvas-axisFrame"),a.$image1=a.$imageLayer.find("#image1"),a.$image2=a.$imageLayer.find("#image2"),a.$activeImage=a.$image1,a.currentImageUrl=null,a.currentShowingImageNum=0,a.$coverLayer=a.$frameLayer.find("#div-cover"),a.$coverContent=a.$coverLayer.find("#td-cover-content"),a.$serverErrorMsg=a.$frameLayer.find("#serverErrorMsg"),a.$parameterErrorMsg=a.$frameLayer.find("#parameterErrorMsg"),a.$cannotRenderingModelMsg=a.$frameLayer.find("#cannotRenderingModelMsg"),a.$modelNotReadyMsg=a.$frameLayer.find("#modelNotReadyMsg"),a.$noSuchModelMsg=a.$frameLayer.find("#noSuchModelMsg"),a.$timeoutMsg=a.$frameLayer.find("#timeoutMsg"),a.$inactiveAppMsg=a.$frameLayer.find("#inactiveAppMsg"),a.$appArrearsMsg=a.$frameLayer.find("#appArrearsMsg"),a.$yuntaiAppFrozenMsg=a.$frameLayer.find("#yuntaiAppFrozenMsg"),a.$noYuntaiAppMsg=a.$frameLayer.find("#noYuntaiAppMsg"),a.$appForbiddenMsg=a.$frameLayer.find("#appForbiddenMsg"),a.isWidthAutoResize=0===i?!0:!1,a.isHeightAutoResize=0===r?!0:!1,a.width=0,a.height=0,a.topHeight=0,a.isCmdbarShow=o,a.canResize=!1,a.effectList=["0","1","3","9"],a.currentEffectIndex=0,a.isWidthAutoResize||a.isHeightAutoResize?(a.width=a.isWidthAutoResize?t(e).width():i,a.height=a.isHeightAutoResize?t(e).height():r,a.canResize=!0):(a.width=i,a.height=r,a.canResize=!1),a.axisFrame=new X3.SvgAxisFrame(a.$svgLayer[0],a.$svgLayer.width(),a.$svgLayer.height()),a.helperLineFrame=new X3.SvgHelperLineFrame(a.$selectLineLayer,a.$selectLineLayer.width(),a.$selectLineLayer.height()),t("html").hasClass("no-touch")||(a.isMobile=!0),a.showControl=function(t){t.show()},a.hideControl=function(t){t.hide()},a.showImage=function(t){t.css("display","block"),t.css("visibility","visible")},a.hideImage=function(t){t.css("display","none"),t.css("visibility","hidden")},a.getScreenRadioSize=function(){var t=a.width,e=a.height,n={width:t,height:e};return n},a.setScreenCursor=function(t){navigator.userAgent.indexOf("MSIE")>0?"default"===t?a.$operateLayer.css("cursor","default"):"rotate"===t||"pan"===t?a.$operateLayer.css("cursor","move"):a.$operateLayer.css("cursor","default"):"default"===t?(a.$operateLayer.removeClass("cursor-pan"),a.$operateLayer.removeClass("cursor-rotate")):"rotate"===t?a.$operateLayer.addClass("cursor-rotate"):"pan"===t?a.$operateLayer.addClass("cursor-pan"):(a.$operateLayer.removeClass("cursor-pan"),a.$operateLayer.removeClass("cursor-rotate"))},a.setViewSize=function(e,n){t("body").css("width",e+"px"),a.$viewLayer.css({height:n,top:a.topHeight}),a.axisFrame.resize(a.$svgLayer.width(),a.$svgLayer.height()),a.helperLineFrame.resize(a.$selectLineLayer.width(),a.$selectLineLayer.height())},a.setControlSize=function(t,e,n){t.css({width:e+"px",height:n+"px"})},a.imageUpdateError=function(){"block"===a.$image1.css("display")?a.currentShowingImageNum=1:"block"===a.$image2.css("display")&&(a.currentShowingImageNum=2),a.hideImage(a.$image1),a.hideImage(a.$image2),a.$coverContent.html(a.$serverErrorMsg.html()),a.$coverLayer.show(),a.$coverContent.find("#reloadModelBtn").click(function(){a.$activeImage.load()})},a.getOffset=function(){for(var t=a.$imageLayer[0],e=t,n=t.offsetLeft,i=t.offsetTop;e=e.offsetParent;)n+=e.offsetLeft,i+=e.offsetTop;var r={x:n,y:i};return r},a.updateImage=function(t){a.currentImageUrl=t,a.$activeImage===a.$image1?a.$image2.attr("src")===t?a.$image2.load():a.$image2.attr("src",t):a.$image1.attr("src")===t?a.$image1.load():a.$image1.attr("src",t)},a.showErrorMessage=function(t){400===t?a.$coverContent.html(a.$parameterErrorMsg.html()):402===t?a.$coverContent.html(a.$cannotRenderingModelMsg.html()):403===t?a.$coverContent.html(a.$modelNotReadyMsg.html()):404===t?a.$coverContent.html(a.$noSuchModelMsg.html()):503===t?a.$coverContent.html(a.$timeoutMsg.html()):600===t?a.$coverContent.html(a.$inactiveAppMsg.html()):601===t?a.$coverContent.html(a.$appArrearsMsg.html()):602===t?a.$coverContent.html(a.$yuntaiAppFrozenMsg.html()):603===t?a.$coverContent.html(a.$noYuntaiAppMsg.html()):604===t?a.$coverContent.html(a.$appForbiddenMsg.html()):a.$coverContent.html(a.$serverErrorMsg.html()),a.$coverContent.find("#reloadModelBtn").click(function(){e.location.reload()})},a.activeImageErrorEvent=function(){a.$image1.error(function(){"#"!==t(this).attr("src")&&a.imageUpdateError()}),a.$image2.error(function(){"#"!==t(this).attr("src")&&a.imageUpdateError()})},a.hideAllDropdown=function(){a.$assistLayer.hide()},a.hideLineLayer=function(){a.helperLineFrame.clear(),a.$selectLineLayer.hide()},a.clearLineLayer=function(){a.helperLineFrame.clear()},a.setHelperLine=function(t,e,n){a.helperLineFrame.draw(t,e,n)},a.setHelperRect=function(t,e){a.$rectangeSelector.show();var n=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y),r=t.x,o=t.y;e.x<t.x&&(r=e.x),e.y<t.y&&(o=e.y),a.$rectangeSelector.css({left:r,top:o,width:n,height:i})},a.show3dButtons=function(){a.$menuLi.each(function(){"3d"===t(this).attr("type")||"all"===t(this).attr("type")?t(this).show():t(this).hide()}),a.$sectionBtn.removeAttr("disabled"),a.$sectionBtn.removeClass("menu-btn-disabled")},a.show2dButtons=function(){a.$menuLi.each(function(){"2d"===t(this).attr("type")||"all"===t(this).attr("type")?t(this).show():t(this).hide()}),a.$sectionBtn.addClass("menu-btn-disabled"),a.$sectionBtn.attr("disabled",!0)},a.activateCancelCutButton=function(){a.hideLineLayer()},a.deactivateSectionButton=function(){a.$sectionBtn.removeClass("menu-btn-active")},a.$sectionBtn.click(function(){t(this).hasClass("menu-btn-disabled")||(a.clearLineLayer(),a.emit(a.Events.CUT_CANCEL))}),a.$viewportBtn.click(function(){a.hideAllDropdown();var e=t(this).attr("viewport");null!=e&&(a.emit(a.Events.VIEWPORT_BUTTON_CLICKED,e),a.emit(a.Events.PIVOT_CANCEL))}),a.$specialEffectBtn.click(function(){a.currentEffectIndex=(a.currentEffectIndex+1)%4,a.emit(a.Events.EFFECT_CHANGED,a.effectList[a.currentEffectIndex]),a.$specialEffectBtn.attr("effect",a.effectList[a.currentEffectIndex]).attr("data-i18n","[title]viewer.special-"+a.effectList[a.currentEffectIndex]).i18n(),a.width>=a.mobileMinWidth&&a.width<=a.mobileMaxWidth&&a.$menuLayer.addClass("menu-opacity-half")}),a.$menuBtnZoomfit.click(function(){a.emit(a.Events.ZOOMFIT_BUTTON_CLICKED),a.emit(a.Events.PIVOT_CANCEL)}),a.$menuBtnZoomwindow.click(function(){a.$rectangeSelector.hide(),a.$rectangeSelector.css({width:0,height:0,left:0,top:0})}),t(e).resize(function(){a.canResize&&(a.isWidthAutoResize&&(a.width=t(e).width()),a.isHeightAutoResize&&(a.height=a.isCmdbarShow&&t(e).width()>a.mobileMaxWidth?t(e).height():t(e).height()),a.setViewSize(a.width,a.height),a.emit(a.Events.WINDOW_RESIZED,{width:a.width,height:a.height}))}),a.$image1.load(function(){a.$coverLayer.hide(),a.showImage(a.$image1),a.hideImage(a.$image2),a.$activeImage=a.$image1,a.$image1.css({top:0,left:0,width:a.width,height:a.height}),a.emit(a.Events.IMAGE_LOADED)}),a.$image2.load(function(){a.$coverLayer.hide(),a.showImage(a.$image2),a.hideImage(a.$image1),a.$activeImage=a.$image2,a.$image2.css({top:0,left:0,width:a.width,height:a.height}),a.emit(a.Events.IMAGE_LOADED)}),a.setViewSize(a.width,a.height),a.showImage(a.$image1),a.hideImage(a.$image2)}}(jQuery,window),window.onload=function(){"use strict";var t={render:"canvas",ecLevel:"H",text:window.location.href,size:$("#div-qrcode").width()-5,mode:4,mSize:.2,mPosX:.5,mPosY:.5,image:$("#img-qrcode-logo")[0]};$("#div-qrcode").empty().qrcode(t)},function(){"use strict";X3.Application=function(){var t=this;t.param={width:0,height:0,isCmdbarShow:!0,containerId:"div-container-main"};var e=$.parseQuery();e.path&&(t.param.modelPath=e.path),t.isCmdbarShow=null==t.param.isCmdbarShow?!0:t.param.isCmdbarShow,t.queue=new X3.Queue,t.view=new X3.View(t.param.containerId,t.param.width,t.param.height,t.isCmdbarShow),t.mediator=new X3.Mediator(t),t.model=new X3.Model,t.startup=function(){X3.emitter.emit(X3.Events.APP_STARTED),t.model.load(t.param.modelPath)}}}.call(this),$(function(){"use strict";window.isReady=!1,Modernizr.touch&&FastClick.attach(document.body);var t=$.parseQuery(),e=t.lang;void 0===e&&null===$.cookie("generalLang")?e="en":void 0===e&&(e=$.cookie("generalLang"));var n={resGetPath:"i18n/__lng__/viewer.json",lng:e,detectLngQS:"lang",cookieName:"generalLang",fallbackLng:"en"};window.i18n.init(n,function(){$("body").i18n();var t=new Menu,e=new X3.Application;X3.app=e,t.setView(X3.app.view),e.startup()})});